<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>安装Pycharm</title>
      <link href="/posts/8b89de9f/"/>
      <url>/posts/8b89de9f/</url>
      
        <content type="html"><![CDATA[<ol><li class="lvl-3"><p>下载资源后解压，以管理员身份运行pycharm-professional-2024.1.exe</p></li></ol><p>解压码：520000</p><p>下载链接：<a href="https://pan.xunlei.com/s/VO41LIAJ5geCjsQuhaUTNRM8A1?pwd=tjwt#">https://pan.xunlei.com/s/VO41LIAJ5geCjsQuhaUTNRM8A1?pwd=tjwt#</a></p><p><img src="g670054-20240812005434554-1485877061.png" alt="img"></p><ol start="2"><li class="lvl-3"><p>安装程序内：下一步 -&gt; 设置安装目录（软件安装不推荐放c盘，可以改成别的盘），下一步 -&gt; 根据需要勾选安装选项，下一步 -&gt; 点击安装 -&gt; wait a minute… -&gt; 取消勾选运行，完成</p></li></ol><p><img src="g670054-20240812005534332-1571787127.png" alt="img"></p><p><img src="g670054-20240812005552831-950427646.png" alt="img"></p><p><img src="g670054-20240812005628989-1191932550.png" alt="img"></p><p><img src="g670054-20240812005645089-240093658.png" alt="img"></p><p><img src="g670054-20240812005720794-1317170926.png" alt="img"></p><p><img src="g670054-20240812005703765-2064376457.png" alt="img"></p><h3 id="激活流程：">激活流程：</h3><ol><li class="lvl-3"><p>解压ja-netfilter-all-2024.x-2022.2.x-20230914.zip</p></li><li class="lvl-3"><p>将解压后文件夹内jetbra文件夹复制粘贴到C盘的根目录，永久激活插件位置：C:\jetbra\scripts （不要删除或移动位置）</p></li></ol><p><img src="g670054-20240812005812348-1022122108.png" alt="img"></p><ol start="3"><li class="lvl-3"><p>进入C:\jetbra\scripts，双击运行install-all-users.vbs，弹窗点击确定</p></li></ol><p><img src="g670054-20240812005902649-48703434.png" alt="img"></p><p><img src="g670054-20240812005918826-748558002.png" alt="img"></p><ol start="4"><li class="lvl-3"><p>等待… （大概几十秒到几分钟，中间没有任何窗口动画，执行完成才会弹出来，请耐心等待，弹出之后才进行下一步）弹窗内出现“DONE”，点击确定</p></li></ol><p><img src="g670054-20240812005946480-824346839.png" alt="img"></p><ol start="5"><li class="lvl-3"><p>启动pycharm，首次启动提示点击“Continue”-&gt; Don’t Send</p></li><li class="lvl-3"><p>Activate PyCharm</p></li></ol><p><img src="g670054-20240812010013492-1896072670.png" alt="img"></p><ol start="7"><li class="lvl-3"><p>打开C:\jetbra目录 激活码.txt，复制【PyCharm-2023.2.x】下面完整的激活码内容</p></li></ol><p><img src="g670054-20240812010110516-516504542.png" alt="img"></p><p><img src="g670054-20240812010144653-1745615715.png" alt="img"></p><ol start="8"><li class="lvl-3"><p>回到PyCharm软件激活界面，选择激活码方式(Activate code)，将激活码粘贴到框内，点击“Activate”</p></li><li class="lvl-3"><p>永久激活成功（有效时间忽略），点击Continue</p></li></ol><h3 id="汉化方法：">汉化方法：</h3><p>File -&gt; Settings -&gt; Plugins -&gt; Marketplace -&gt; 输入Chinese搜索 -&gt; Chinese (Simplified) Language Pack / 中文语言包 -&gt; 安装 -&gt; 重启PyCharm</p><p><img src="g670054-20240812010442723-626880976.png" alt="img"></p><p><img src="g670054-20240812010541570-789360701.png" alt="img"></p><p><img src="g670054-20240812010610010-300931416.png" alt="img"></p><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://www.cnblogs.com/ft-Pavilion/p/18354195">pycharm专业版的安装和破解教程</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pycharm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装Typora</title>
      <link href="/posts/12fa9bf/"/>
      <url>/posts/12fa9bf/</url>
      
        <content type="html"><![CDATA[<blockquote><p>实测可用日期为：2024-11-19</p><p>目前最新版本 1.8.10.0 也是可以实现激活</p><p>注：免修改<a href="https://so.csdn.net/so/search?q=%E6%B3%A8%E5%86%8C%E8%A1%A8&amp;spm=1001.2101.3001.7020">注册表</a>、不用修改时间，更不需要改补丁</p></blockquote><h1>01、下载&amp;安装 Typora</h1><p>从官网下载最新版本的 Typora，并安装<img src="/img/%E5%AE%89%E8%A3%85Typora/38bd5cd75dad7eae8b01b3036cfb99b6.png" alt="aaec86fd073442f099182e1764588c39.png"></p><p><a href="/download/tools/typora-setup-x64.exe" download> 点击下载 </a></p><h1>02、开始激活Typora</h1><p>找到Typora安装目录，依次找到这个文件</p><p><code>resources\page-dist\static\js\LicenseIndex.**********.********.chunk.js</code></p><p>用记事本打开它，查找以下字段：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.hasActivated=&quot;true&quot;==e.hasActivated,</span><br></pre></td></tr></table></figure><p>替换为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.hasActivated=&quot;true&quot;==&quot;true&quot;,</span><br></pre></td></tr></table></figure><p>保存文件失败的话，可以先保存到桌面，再去替换原来的文件</p><h1>03、关闭软件每次启动时的已激活的弹窗</h1><blockquote><p>注意：这个时候打开软件已经提示激活成功了</p><p>由于每次打开软件都会弹出“已激活”的窗口，下面是关闭这个弹窗。</p></blockquote><p>在Typora安装目录依次找到这个文件</p><p><code>resources\page-dist\license.html</code></p><p>用记事本打开它，查 找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>替换为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/body&gt;&lt;script&gt;window.onload=function()&#123;setTimeout(()=&gt;&#123;window.close();&#125;,5);&#125;&lt;/script&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><h1>04、去除软件左下角“未激活”提示</h1><p>在Typora安装目录依次找到这个文件</p><p><code>resources\locales\zh-Hans.lproj\Panel.json</code></p><p>查找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;UNREGISTERED&quot;:&quot;未激活&quot;,</span><br></pre></td></tr></table></figure><p>替换为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;UNREGISTERED&quot;:&quot; &quot;,</span><br></pre></td></tr></table></figure><h1>05、操作结束</h1><p>操作后的 Typora，各种功能均能正常使用，仅有“许可证信息”/“我的许可证”页面无法打开、左下角存在“x”（可手工点击关闭但重新打开软件会重新出现）。</p><p>如果弹窗提示错误，就点击一下下图中的位置，再关闭浏览器就行了。</p><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://blog.csdn.net/m0_58416529/article/details/136098186">2024Typora破解，最新版本的1.8.10.0可用</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工具类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Typora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx代理docker容器中运行的服务</title>
      <link href="/posts/bc3ada4d/"/>
      <url>/posts/bc3ada4d/</url>
      
        <content type="html"><![CDATA[<p>云服务器上运行了很多的docker服务，大多数服务都是没有验证的，可以通过nginx做集中的代理，并在nginx上配置用户名密码验证，避免非授权访问。</p><p>遇到的问题如下：<br><strong>Q1 容器的IP是不固定的，如何配置nginx的代理？</strong><br><strong>A1 通过创建docker网络，使nginx容器与业务容器在同一个网络中，这样就可以通过容器名称进行代理，不需要关注容器的IP地址</strong></p><p><strong>Q2 新上线的业务容器/修改了业务容器端口，要修改nginx代理文件，又要重新加载nginx配置，有没有便捷的方式？</strong><br><strong>A2 通过挂在的方式，将代理的配置文件放在宿主机，容器内运行检测脚本，当发现配置文件发生变化时，自动重载</strong></p><h1>部署步骤</h1><h2 id="前置条件">前置条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建docker网络</span></span><br><span class="line">docker network create docker-net</span><br><span class="line"><span class="comment"># 所有的业务容器运行是使用--net参数使用该网络</span></span><br><span class="line">--net docker-net</span><br></pre></td></tr></table></figure><h2 id="制作nginx镜像">制作nginx镜像</h2><ul class="lvl-0"><li class="lvl-2"><p>新建检测脚本</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> monitor.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  md5=`<span class="built_in">md5sum</span> /etc/nginx/conf.d/port-to-domain.conf | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">  grep <span class="variable">$&#123;md5&#125;</span> /tmp/md5result &amp;&gt;/dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Config File Change&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec&#x27;</span></span><br><span class="line">    nginx -t</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec success&#x27;</span></span><br><span class="line">      nginx -s reload</span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -s reload exec&#x27;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec failed&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;md5&#125;</span> &gt; /tmp/md5result</span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Change md5result&#x27;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>因为要运行检测脚本，所以要修改一下nginx默认的cmd</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个启动服务的脚本</span></span><br><span class="line">$ <span class="built_in">cat</span> start-nginx-server.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> bash /opt/monitor.sh &amp;&gt;/var/log/monitor.log &amp;</span><br><span class="line">nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改文件权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x start-nginx-server.sh monitor.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建Dockerfile</span></span><br><span class="line">$ <span class="built_in">cat</span> Dockerfile </span><br><span class="line">FROM nginx:latest</span><br><span class="line">ADD monitor.sh /opt/</span><br><span class="line">ADD start-nginx-server.sh /usr/local/bin/</span><br><span class="line">CMD [<span class="string">&quot;/usr/local/bin/start-nginx-server.sh&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">docker build -t nginx_pass:v1 . </span><br></pre></td></tr></table></figure><h2 id="准备nginx配置文件">准备nginx配置文件</h2><p>在宿主机准备配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/opt/etc/nginx/conf.d<span class="comment"># more port-to-domain.conf </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    server_name     vscode.xxxx.com;</span><br><span class="line">    location ^~ / &#123;</span><br><span class="line">        proxy_pass      http://vscode:8086; <span class="comment"># 转发,vscode为业务容器的名称</span></span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;  <span class="comment">#获取客户端真实IP</span></span><br><span class="line">        proxy_set_header REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    server_name     cmd.xxx.com;</span><br><span class="line">    location ^~ / &#123;</span><br><span class="line">        proxy_pass      http://cmd:88; <span class="comment"># 转发，cmd为业务容器的名称</span></span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;  <span class="comment">#获取客户端真实IP</span></span><br><span class="line">        proxy_set_header REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>运行容器</h1><p>运行nginx容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 挂载的目录要根据实际的进行修改</span></span><br><span class="line">docker run -d --name nginx_pass -p 80:80 -v /opt/etc/nginx/conf.d:/etc/nginx/conf.d --net docker-net --restart=always  nginx_pass:v1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode如何恢复hexo博客环境</title>
      <link href="/posts/e245ef8f/"/>
      <url>/posts/e245ef8f/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本博客环境在vscode容器中，所以是当vscode容器被删除后(数据还在的情况下)，如何恢复环境</p></blockquote><h1>运行vscode容器</h1><ul class="lvl-0"><li class="lvl-2"><p>由于国内<code>docker</code>被搬，需要使用以下命令进行镜像拉取。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.1panel.dev/codercom/code-server</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>运行容器</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name vscode --net docker-net --restart always -v /data/codes:/home/coder/project -v /etc/localtime:/etc/localtime -e PASSWORD=<span class="string">&#x27;访问密码&#x27;</span> docker.1panel.dev/codercom/code-server --auth=password</span><br></pre></td></tr></table></figure><h1>容器内安装环境</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入hexo目录，具体目录根据实际而定</span></span><br><span class="line"><span class="built_in">cd</span> /home/coder/project/hexo-blog </span><br><span class="line"><span class="comment"># 配置apt源，vscode使用的是debian的系统</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s/deb.debian.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list.d/debian.sources</span><br><span class="line"><span class="comment"># 更新源</span></span><br><span class="line">sudo apt update</span><br><span class="line"><span class="comment"># 安装 npm</span></span><br><span class="line">sudo apt install npm</span><br><span class="line"><span class="comment"># 配置npm的源</span></span><br><span class="line">sudo npm config <span class="built_in">set</span> registry https://registry.npmmirror.com/</span><br><span class="line"><span class="comment"># 安装hexo cli等</span></span><br><span class="line">sudo npm install hexo-cli </span><br><span class="line">sudo npm install</span><br><span class="line">sudo npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h1>生成新的连接密钥</h1><ul class="lvl-0"><li class="lvl-2"><p>生成密钥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Github用户名&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;Github邮箱@qq.com&quot;</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;Gihub邮箱@qq.com&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>将密钥添加到<code>Github项目 &gt; settings &gt; SSH and GPG keys</code>中<br><img src="%E6%9B%B4%E6%8D%A2sshkey.png" alt="添加SSH key"></p></li></ul><h1>环境测试</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/coder/project/hexo-blog </span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://aoleye.github.io/2024/08/07/hexoxdn/index.html">Hexo更换新电脑后需要的迁移操作，备份文件及恢复方法（突然看到比较简单详细的相关文章，记录一下）</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在Prometheus的rule文件中使用判断语句和变量</title>
      <link href="/posts/25711707/"/>
      <url>/posts/25711707/</url>
      
        <content type="html"><![CDATA[<blockquote><p>话不多说，直接给出示例，相信一眼就能看到怎么用了</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hostStatsAlert300s</span></span><br><span class="line">  <span class="attr">interval:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">磁盘使用率超过阈值告警</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">((node_filesystem_size_bytes</span> <span class="bullet">-</span> <span class="string">node_filesystem_avail_bytes)</span> <span class="string">/</span> <span class="string">node_filesystem_size_bytes)</span> <span class="string">*</span> <span class="string">on(instance)</span> <span class="string">group_left(nodename)</span> <span class="string">(node_uname_info)</span> <span class="string">&gt;</span> <span class="number">0.7</span></span><br><span class="line">    <span class="attr">labels:</span> </span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; if gt $value 0.9 &#125;&#125;</span> 紧急告警 <span class="template-variable">&#123;&#123; else if gt $value 0.8 &#125;&#125;</span> 重要告警 <span class="template-variable">&#123;&#123; else if gt $value 0.7 &#125;&#125;</span> 次要告警 <span class="template-variable">&#123;&#123; end &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;主机 <span class="template-variable">&#123;&#123; $labels.nodename &#125;&#125;</span>  目录 <span class="template-variable">&#123;&#123; $labels.mountpoint &#125;&#125;</span> 磁盘使用率过高&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;主机<span class="template-variable">&#123;&#123; $labels.nodename &#125;&#125;</span> 磁盘使用率过高，告警阈值：<span class="template-variable">&#123;&#123; if gt $value 0.9 &#125;&#125;</span>90<span class="template-variable">%&#123;&#123; else if gt $value 0.8 &#125;</span>&#125;80<span class="template-variable">%&#123;&#123; else if gt $value 0.7 &#125;</span>&#125;70<span class="template-variable">%&#123;&#123; end &#125;</span>&#125;，当前使用率：<span class="template-variable">&#123;&#123; $value | humanizePercentage &#125;&#125;</span>，目录：<span class="template-variable">&#123;&#123; $labels.mountpoint &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>$labels</code>：在web界面查询出来的所有标签值都能用</p></li><li class="lvl-2"><p><code>$value</code>：警报触发时的表达式计算结果</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus告警中如何携带主机名</title>
      <link href="/posts/cbb5ee1c/"/>
      <url>/posts/cbb5ee1c/</url>
      
        <content type="html"><![CDATA[<p>主机名<code>（nodename）</code>在指标<code>node_uname_info</code>中，且<code>node_uname_info</code>的值恰巧为1，所以我们可以在<code>PromQL</code>中通过<code>node_uname_info</code>提取，只需要在原有<code>PromQL</code>后添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* on(instance) group_left(nodename) (node_uname_info)</span><br></pre></td></tr></table></figure><p>这样，在prometheus告警的labels中，就可以通过nodename获取主机名了</p><p>比如原先的expr为</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">node_filesystem_size_bytes</span> <span class="bullet">-</span> <span class="string">node_filesystem_avail_bytes)</span> <span class="string">/</span> <span class="string">node_filesystem_size_bytes</span> <span class="string">&gt;</span> <span class="number">0.7</span></span><br></pre></td></tr></table></figure><p>修改为以下的expr就行</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">((node_filesystem_size_bytes</span> <span class="bullet">-</span> <span class="string">node_filesystem_avail_bytes)</span> <span class="string">/</span> <span class="string">node_filesystem_size_bytes)</span> <span class="string">*</span> <span class="string">on</span> <span class="string">(instance)</span> <span class="string">group_left</span> <span class="string">(nodename)</span> <span class="string">(node_uname_info)</span> <span class="string">&gt;</span> <span class="number">0.7</span></span><br></pre></td></tr></table></figure><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://www.cnblogs.com/heian99/p/15257897.html#:~:text=%E4%B8%BB%E6%9C%BA%E5%90%8D%EF%BC%88nodena">Prometheus监控，生产可用告警规则（可获取主机名）</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>热重载Prometheus和AlertManager配置文件</title>
      <link href="/posts/ed0140b7/"/>
      <url>/posts/ed0140b7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>如果每次修改配置文件都需要重启服务，那就太操蛋了。</p></blockquote><h1>Prometheus配置文件重载</h1><p><strong>必要条件</strong>：Prometheus在2.0版本后<code>hot reload</code> 功能是默认关闭的，如需开启，需要在启动<code>Prometheus</code>的时候，添加<code> --web.enable-lifecycle</code> 参数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker 运行示例</span></span><br><span class="line">docker run -d  --name prom-server prometheus --web.enable-lifecycle --config.file=/etc/prometheus/prometheus.yml</span><br></pre></td></tr></table></figure><p><strong>重载文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -X POST http://WEBURL/-/reload</span><br></pre></td></tr></table></figure><p>接下来就可以看文件有没有<code>reload</code>日志打印了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ts=2024-10-08T07:38:57.506Z <span class="built_in">caller</span>=main.go:1367 level=info msg=<span class="string">&quot;Loading configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml</span><br><span class="line">ts=2024-10-08T07:38:57.508Z <span class="built_in">caller</span>=main.go:1415 level=info msg=<span class="string">&quot;Completed loading of configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml totalDuration=1.791304ms db_storage=1.533µs remote_storage=1.493µs web_handler=471ns query_engine=1.122µs scrape=74.5µs scrape_sd=39.955µs notify=17.532µs notify_sd=11.622µs rules=1.293589ms tracing=2.935µs</span><br><span class="line">ts=2024-10-08T07:39:24.210Z <span class="built_in">caller</span>=main.go:1367 level=info msg=<span class="string">&quot;Loading configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml</span><br><span class="line">ts=2024-10-08T07:39:24.212Z <span class="built_in">caller</span>=main.go:1415 level=info msg=<span class="string">&quot;Completed loading of configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml totalDuration=1.753011ms db_storage=1.512µs remote_storage=1.503µs web_handler=541ns query_engine=1.182µs scrape=84.148µs scrape_sd=37.81µs notify=15.93µs notify_sd=9.338µs rules=1.194914ms tracing=3.727µs</span><br><span class="line">ts=2024-10-08T08:02:58.620Z <span class="built_in">caller</span>=main.go:1367 level=info msg=<span class="string">&quot;Loading configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml</span><br><span class="line">ts=2024-10-08T08:02:58.622Z <span class="built_in">caller</span>=main.go:1415 level=info msg=<span class="string">&quot;Completed loading of configuration file&quot;</span> filename=/etc/prometheus/prometheus.yml totalDuration=1.705142ms db_storage=1.603µs remote_storage=1.803µs web_handler=501ns query_engine=1.062µs scrape=81.222µs scrape_sd=34.655µs notify=15.208µs notify_sd=10.019µs rules=1.183322ms tracing=3.437µs</span><br></pre></td></tr></table></figure><h1>AlertManager文件重载</h1><p><code>AlertManager</code>默认支持热重载文件，通过以下命令进行重载操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://WEBURL/-/reload</span><br></pre></td></tr></table></figure><p>查看日志是否有<code>reload</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ts=2024-10-08T08:13:15.421Z <span class="built_in">caller</span>=coordinator.go:113 level=info component=configuration msg=<span class="string">&quot;Loading configuration file&quot;</span> file=/etc/alertmanager/alertmanager.yml</span><br><span class="line">ts=2024-10-08T08:13:15.422Z <span class="built_in">caller</span>=coordinator.go:126 level=info component=configuration msg=<span class="string">&quot;Completed loading of configuration file&quot;</span> file=/etc/alertmanager/alertmanager.yml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
            <tag> AlertManager </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus-AlertManager设置邮件发送告警信息</title>
      <link href="/posts/6bafdf3f/"/>
      <url>/posts/6bafdf3f/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以网易163邮箱为例</p></blockquote><p>修改<code>alertmanager.yml</code>文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">resolve_timeout:</span> <span class="string">5m</span> <span class="comment"># 当警报恢复后，等待这个时长才认为警报真正解决</span></span><br><span class="line">  <span class="attr">smtp_from:</span> <span class="string">&#x27;xxxx@163.com&#x27;</span> <span class="comment"># 发送警报邮件的发件人邮箱地址</span></span><br><span class="line">  <span class="attr">smtp_smarthost:</span> <span class="string">&#x27;smtp.163.com:465&#x27;</span> <span class="comment"># 邮件发送使用的SMTP服务器地址和端口</span></span><br><span class="line">  <span class="attr">smtp_auth_username:</span> <span class="string">&#x27;xxx@163.com&#x27;</span> <span class="comment"># 用于SMTP认证的用户名，通常是发件人的邮箱地址</span></span><br><span class="line">  <span class="attr">smtp_auth_password:</span> <span class="string">&#x27;xxxxxxx&#x27;</span> <span class="comment"># 用于SMTP认证的密码，这里应该是邮箱的授权码（token），而非登录密码</span></span><br><span class="line">  <span class="attr">smtp_require_tls:</span> <span class="literal">false</span> <span class="comment"># 是否要求使用TLS加密邮件传输，这里设置为false表示不强制要求</span></span><br><span class="line">  <span class="attr">smtp_hello:</span> <span class="string">&#x27;163.com&#x27;</span> <span class="comment"># SMTP连接时的HELO/EHLO标识，通常使用邮件服务商的域名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">&#x27;alertname&#x27;</span>] <span class="comment"># 按照警报名称对警报进行分组</span></span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">30s</span> <span class="comment"># 在将警报发送给接收者之前等待的时间，以便收集更多相关警报</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">5m</span> <span class="comment"># 分组后，每隔这个时长检查一次是否有新警报加入同一分组</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">1h</span> <span class="comment"># 对于同一个分组的警报，每隔这个时长重复发送一次通知</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">&#x27;163email&#x27;</span> <span class="comment"># 默认的警报通知接收者，这里引用了下面定义的receivers中的一个</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># receivers中定义了警报通知的接收者，包括他们的联系方式</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;163email&#x27;</span> <span class="comment"># 接收者的名称，用于在route中引用</span></span><br><span class="line">    <span class="attr">email_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&#x27;xxx@yeah.net&#x27;</span> <span class="comment"># 接收警报邮件的邮箱地址</span></span><br><span class="line">        <span class="attr">send_resolved:</span> <span class="literal">true</span> <span class="comment"># 当警报恢复时，是否发送恢复通知邮件</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
            <tag> AlertManager </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus基于文件的自动发现</title>
      <link href="/posts/13b4287e/"/>
      <url>/posts/13b4287e/</url>
      
        <content type="html"><![CDATA[<h1>一、自动发现服务</h1><p>每次修改<code>Prometheus</code>配置文件都需要重载服务，未免有些麻烦，而自动发现服务就是为了解决这种麻烦事儿的，自动发现服务又分为好几种，其中基于文件的服务发现是最通用的方式。这种方式不需要依赖于任何的平台或者第三方服务。<code>Prometheus</code>会定时从文件中读取最新的<code>Target</code>信息，因此，我们可以通过任意的方式将监控<code>Target</code>的信息写入即可。</p><h1>二、配置</h1><h2 id="步骤1-修改prometheus-yml文件">步骤1 修改<code>prometheus.yml</code>文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;file_sd_default&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">files:</span> [<span class="string">&#x27;/etc/prometheus/config/sd_config/*.yml&#x27;</span>]</span><br><span class="line">    <span class="attr">refresh_interval:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>file_sd_configs</code>：说明配置为基于文件的自动发现服务</p></li><li class="lvl-2"><p><code>files</code>：文件存放位置</p></li><li class="lvl-2"><p><code>refresh_interval</code>: 读取的周期</p></li></ul><h2 id="步骤2-创建targets文件">步骤2 创建targets文件</h2><ul class="lvl-0"><li class="lvl-2"><p>创建文件</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/prometheus/config/sd_config/xxx.yml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>写入targets</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;localhost:9090&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>如果需要添加验证，则需要在jobs添加</strong></p><ul class="lvl-0"><li class="lvl-2"><p>修改<code>prometheus.yml</code>文件</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;file_sd_node&#x27;</span></span><br><span class="line">    <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span> [<span class="string">&#x27;/etc/prometheus/config/sd_config/node/node.yml&#x27;</span>]</span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">basic_auth:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">用户名</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">密码</span></span><br></pre></td></tr></table></figure><p>通过这种方式，Prometheus会自动的周期性读取文件中的内容。当文件中定义的内容发生变化时，不需要对Prometheus进行任何的重启操作。</p><p><code>Targets</code>可以通过<code>Promethtus</code>的<code>web</code>界面，<code>Status &gt; Targets</code>查看</p><h1>三、Rule的自动加载</h1><p>Rule无法使用Targets的方式，推荐办法是在修改完Rule之后，使用以下命令进行配置的重新加载（不是重启）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">kill</span> -HUP $(pgrep prometheus)</span><br><span class="line"><span class="comment"># 或者使用curl方式</span></span><br><span class="line">curl -X POST http://WEBIP/-/reload</span><br></pre></td></tr></table></figure><p><strong><code>HUP</code>信号</strong></p><ul class="lvl-0"><li class="lvl-2"><p>全称：<code>Hang Up signal</code>。</p></li><li class="lvl-2"><p>用途：当进程接收到<code>HUP</code>信号时，它通常会执行挂起操作，这通常意味着进程会关闭打开的文件描述符并重新读取其配置文件。对于许多守护进程<code>（daemon）</code>来说，<code>HUP</code>信号是一个请求进程重新加载配置文件的常用方式。</p></li><li class="lvl-2"><p>常见使用场景：<code>HUP</code>信号常用于服务的平滑重启，特别是对于那些需要持续运行且不能轻易停止的服务。通过发送HUP信号，可以让服务在不中断的情况下重新加载配置。因此，当你执行<code>sudo kill -HUP pgrep prometheus</code>命令时，你实际上是在告诉系统向所有名为<code>prometheus</code>的进程发送一个<code>HUP</code>信号，请求它们重新加载配置文件。这对于<code>Prometheus</code>这样的监控服务非常有用，因为它允许管理员在不中断监控服务的情况下更新配置。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阿里云-使用Prometheus配置报警规则的最佳实践</title>
      <link href="/posts/68a5e006/"/>
      <url>/posts/68a5e006/</url>
      
        <content type="html"><![CDATA[<h1>使用Prometheus配置报警规则的最佳实践 - 阿里云</h1><p><code>ACK</code>从集群稳定性、集群节点异常、集群节点水位、应用容器副本异常、工作负载异常、存储异常、网络异常等多个方面，通过集群、应用的运维经验沉淀，总结梳理出以下<code>Prometheus</code>重要报警规则配置。</p><p>报警规则包含容器副本异常、工作负载异常等内容，分为以下级别。</p><ul class="lvl-0"><li class="lvl-2"><p><code>Critical</code>：造成集群、应用、甚至业务影响，需要立即处理。</p></li><li class="lvl-2"><p><code>Warning</code>：造成集群、应用、甚至业务影响，需要尽快排查。</p></li><li class="lvl-2"><p><code>Normal</code>：涉及重要功能变更。</p></li></ul><h1>报警规则说明</h1><p>ACK从集群稳定性、集群节点异常、集群节点水位、应用容器副本异常、工作负载异常、存储异常、网络异常等多个方面，通过集群、应用的运维经验沉淀，总结梳理出以下Prometheus重要报警规则配置。</p><h2 id="容器副本异常">容器副本异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>Pod状态异常</td><td>Critical</td><td><code>min_over_time(sum by (namespace, pod, phase) (kube_pod_status_phase&#123;phase=~&quot;Pending|Unknown|Failed&quot;&#125;)[5m:1m]) &gt; 0</code></td><td>最近5分钟内，Pod的状态有异常时，触发报警。</td><td>关于Pod状态异常的处理方法，请参见<a href="#">Pod异常问题排查</a>。</td></tr><tr><td>Pod启动失败</td><td>Critical</td><td><code>sum_over_time(increase(kube_pod_container_status_restarts_total&#123;&#125;)[5m:1m]) &gt; 3</code></td><td>最近5分钟内，Pod启动异常累计3次以上时，触发报警。</td><td>关于Pod启动失败的处理方法，请参见<a href="#">Pod异常问题排查</a>。</td></tr><tr><td>超1000个Pod调度失败异常</td><td>Critical</td><td><code>sum(sum(max_over_time(kube_pod_status_phase&#123; phase=~&quot;Pending&quot;&#125;[5m])) by (pod)) &gt; 1000</code></td><td>最近5分钟内，累计有1000个Pod处于调度失败Pending状态时，触发报警。</td><td>可能是大规模集群调度场景下任务压力过大引起的。推荐使用ACK集群Pro版。</td></tr><tr><td>容器CPU限流频繁</td><td>Warning</td><td><code>rate(container_cpu_cfs_throttled_seconds_total[3m]) * 100 &gt; 25</code></td><td>容器CPU被频繁限流。最近3分钟内，被限流的CPU时间片大于25%时，触发报警。</td><td>针对这种情况，请评估Pod的CPU资源Limit是否配置过小。推荐使用CPU Burst性能优化策略。</td></tr><tr><td>容器副本Pod的CPU资源水位高于85%</td><td>Warning</td><td><code>sum(irate(container_cpu_usage_seconds_total&#123;pod=~&quot;&#123;&#123;PodName&#125;&#125;.*&quot;,namespace=~&quot;&#123;&#123;Namespace&#125;&#125;.*&quot;,container!=&quot;&quot;,container!=&quot;POD&quot;&#125;[1m])) by (namespace,pod) / sum(container_spec_cpu_quota&#123;pod=~&quot;&#123;&#123;PodName&#125;&#125;.*&quot;,namespace=~&quot;&#123;&#123;Namespace&#125;&#125;.*&quot;,container!=&quot;&quot;,container!=&quot;POD&quot;&#125;/100000) by (namespace,pod) * 100 &lt;= 100 or on() vector(0) &gt;= 85</code></td><td>在指定命名空间或Pod下，容器副本Pod的CPU资源水位超过Pod Limit的85%时，会触发报警。</td><td>当Pod的CPU资源水位较高时，会造成CPU资源限流，导致CPU时间片分配不足，最终影响Pod中进程的执行。</td></tr><tr><td>容器副本Pod的内存资源水位高于85%</td><td>Warning</td><td><code>(sum(container_memory_working_set_bytes&#123;pod=~&quot;&#123;&#123;PodName&#125;&#125;.*&quot;,namespace=~&quot;&#123;&#123;Namespace&#125;&#125;.*&quot;,container !=&quot;&quot;,container!=&quot;POD&quot;&#125;) by (pod,namespace)/ sum(container_spec_memory_limit_bytes&#123;pod=~&quot;&#123;&#123;PodName&#125;&#125;.*&quot;,namespace=~&quot;&#123;&#123;Namespace&#125;&#125;.*&quot;,container !=&quot;&quot;,container!=&quot;POD&quot;&#125;) by (pod, namespace) * 100) &lt;= 100 or on() vector(0) &gt;= 85</code></td><td>容器副本Pod的内存资源水位高于Pod Limit的85%时，触发报警。</td><td>当Pod的内存资源水位较高时，会造成Pod被OOMKilled，继而导致Pod重启。</td></tr></tbody></table><h2 id="工作负载异常">工作负载异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>Deployment可用副本状态异常</td><td>Critical</td><td><code>kube_deployment_spec_replicas&#123;&#125; != kube_deployment_status_replicas_available&#123;&#125;</code></td><td>Deployment可用副本数未达到预期时，触发报警。</td><td>确定是否有Deployment的Pod启动失败。</td></tr><tr><td>DaemonSet副本状态异常</td><td>Critical</td><td><code>((100 - kube_daemonset_status_number_ready&#123;&#125; / kube_daemonset_status_desired_number_scheduled&#123;&#125; * 100) or (kube_daemonset_status_desired_number_scheduled&#123;&#125; - kube_daemonset_status_current_number_scheduled&#123;&#125;)) &gt; 0</code></td><td>DaemonSet的可用副本数未达到预期时，触发报警。</td><td>确定是否有Deployment的Pod启动失败。</td></tr><tr><td>DaemonSet副本调度异常</td><td>Critical</td><td><code>kube_daemonset_status_number_misscheduled&#123;job&#125; &gt; 0</code></td><td>DaemonSet的副本调度异常时，触发报警。</td><td>确定是否有Deployment的Pod启动失败。</td></tr><tr><td>Job运行失败</td><td>Critical</td><td><code>kube_job_status_failed&#123;&#125; &gt; 0</code></td><td>Job执行失败时，触发报警。</td><td>在对应Job下的Pod的日志中查看详细失败信息。</td></tr></tbody></table><h2 id="存储异常">存储异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>PersistentVolume状态异常</td><td>Critical</td><td><code>kube_persistentvolume_status_phase&#123;phase=~&quot;Failed|Pending&quot;&#125; &gt; 0</code></td><td>存储卷PV状态异常时，触发报警。</td><td>关于PersistentVolume状态异常的处理方法，请参见<a href="#">云盘存储卷FAQ</a>的云盘挂载内容。</td></tr><tr><td>节点磁盘空间不足10%</td><td>Critical</td><td><code>((node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes) &lt; 10</code></td><td>节点某磁盘块设备可用空间不足10%时，触发报警。</td><td>建议扩容节点和节点磁盘。</td></tr></tbody></table><h2 id="节点状态异常">节点状态异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>节点NotReady状态持续3分钟</td><td>Critical</td><td><code>(sum(max_over_time(kube_node_status_condition&#123;condition=&quot;Ready&quot;,status=&quot;true&quot;&#125;[3m]) &lt;= 0) by (node)) or (absent(kube_node_status_condition&#123;condition=&quot;Ready&quot;,status=&quot;true&quot;&#125;)) &gt; 0</code></td><td>集群节点NotReady状态持续3分钟时，触发报警。</td><td>确定节点NotReady状态是否符合预期。</td></tr></tbody></table><h2 id="宿主机水位异常">宿主机水位异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>宿主机内存水位高于85%</td><td>Warning</td><td><code>(100 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100) &gt;= 85</code></td><td>该集群的宿主机内存水位高于85%时，触发报警。</td><td>释放资源。推荐使用成本洞察功能检查是否有Pod占用了可调度资源。</td></tr><tr><td>宿主机内存水位高于90%</td><td>Critical</td><td><code>(100 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100) &gt;= 90</code></td><td>该集群的宿主机内存水位高于90%。</td><td>释放资源。推荐使用成本洞察功能检查是否有Pod占用了可调度资源。</td></tr><tr><td>宿主机CPU水位高于85%</td><td>Warning</td><td><code>100 - (avg by(instance) (rate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[2m])) * 100) &gt;= 85</code></td><td>该集群的宿主机CPU水位高于85%时，触发报警。</td><td>释放资源。推荐使用成本洞察功能检查是否有Pod占用了可调度资源。</td></tr><tr><td>宿主机CPU水位高于90%</td><td>Critical</td><td><code>100 - (avg by(instance) (rate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[2m])) * 100) &gt;= 90</code></td><td>该集群的宿主机CPU水位高于90%时，触发报警。</td><td>释放资源。推荐使用成本洞察功能检查是否有Pod占用了可调度资源。</td></tr></tbody></table><h2 id="节点资源异常">节点资源异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>节点CPU资源分配率高于85%</td><td>Normal</td><td><code>(sum(sum(kube_pod_container_resource_requests&#123;resource=&quot;cpu&quot;&#125;) by (pod, node) * on (pod) group_left max(kube_pod_status_ready) by (pod, node)) by (node)) / sum(kube_node_status_allocatable&#123;resource=&quot;cpu&quot;&#125;) by (node) * 100 &gt;= 85</code></td><td>该集群节点的CPU已分配水位高于85%时，触发报警。</td><td>该节点可再被调度的资源不足，超过可分配规格的Pod需要被调度到其他节点。</td></tr><tr><td>节点CPU超卖率高于300%</td><td>Warning</td><td><code>(sum(sum(kube_pod_container_resource_limits&#123;resource=&quot;cpu&quot;&#125;) by (pod, node) * on (pod) group_left max(kube_pod_status_ready) by (pod, node)) by (node)) / sum(kube_node_status_allocatable&#123;resource=&quot;cpu&quot;&#125;) by (node) * 100 &gt;= 300</code></td><td>该集群节点的CPU超卖水位高于300%时，触发报警。</td><td>节点上已调度的Pod的资源Limit的总和远大于节点总可分配资源。</td></tr><tr><td>节点内存使用水位高于85%</td><td>Warning</td><td><code>sum(container_memory_working_set_bytes&#123;pod!=&quot;&quot;&#125;) by (node) / sum(kube_node_status_allocatable&#123;resource=&quot;memory&quot;&#125;) by (node) * 100 &gt;= 85</code></td><td>该集群节点的内存水位高于85%时，触发报警。</td><td>释放资源。推荐使用成本洞察功能检查是否有Pod占用了可调度资源。</td></tr><tr><td>节点内存资源分配率高于85%</td><td>Normal</td><td><code>(sum(sum(kube_pod_container_resource_requests&#123;resource=&quot;memory&quot;&#125;) by (pod, node) * on (pod) group_left max(kube_pod_status_ready) by (pod, node)) by (node)) / sum(kube_node_status_allocatable&#123;resource=&quot;memory&quot;&#125;) by (node) * 100 &gt;= 85</code></td><td>该集群节点的内存已分配水位高于85%时，触发报警。</td><td>该节点可再被调度的资源不足，超过可分配规格的Pod需要被调度到其他节点。</td></tr><tr><td>节点内存超卖率高于300%</td><td>Warning</td><td><code>(sum(sum(kube_pod_container_resource_limits&#123;resource=&quot;memory&quot;&#125;) by (pod, node) * on (pod) group_left max(kube_pod_status_ready) by (pod, node)) by (node)) / sum(kube_node_status_allocatable&#123;resource=&quot;memory&quot;&#125;) by (node) * 100 &gt;= 300</code></td><td>该集群节点的内存超卖水位高于300%时，触发报警。</td><td>节点上已调度的Pod的资源限制Limit的总和远大于节点总可分配资源。</td></tr></tbody></table><h2 id="网络异常">网络异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>集群CoreDNS可用性异常-请求跌零</td><td>Critical</td><td><code>(sum(rate(coredns_dns_request_count_total&#123;&#125;[1m]))by(server,zone)&lt;=0) or (sum(rate(coredns_dns_requests_total&#123;&#125;[1m]))by(server,zone)&lt;=0)</code></td><td>仅ACK托管集群（Pro版、基础版）支持检测该异常。</td><td>检查集群中CoreDNS Pod是否正常。</td></tr><tr><td>集群CoreDNS可用性异常-panic异常</td><td>Critical</td><td><code>sum(rate(coredns_panic_count_total&#123;&#125;[3m])) &gt; 0</code></td><td>仅ACK托管集群（Pro版、基础版）支持检测该异常。</td><td>检查集群中CoreDNS Pod是否正常。若CoreDNS行为不符合预期，请提交工单咨询。</td></tr><tr><td>集群IngressController证书即将过期</td><td>Warning</td><td><code>((nginx_ingress_controller_ssl_expire_time_seconds - time()) / 24 / 3600) &lt; 14</code></td><td>您需要安装部署ACK Ingress Controller组件，并开启Ingress功能。</td><td>重新签发Ingress Controller证书。</td></tr></tbody></table><h2 id="弹性伸缩异常">弹性伸缩异常</h2><table><thead><tr><th>详细描述</th><th>重要级别</th><th>PromQL配置</th><th>规则说明</th><th>常见处理SOP流程</th></tr></thead><tbody><tr><td>HPA当前副本数已达最大副本设置数</td><td>Warning</td><td><code>max(kube_horizontalpodautoscaler_spec_max_replicas) by (namespace, horizontalpodautoscaler) - max(kube_horizontalpodautoscaler_status_current_replicas) by (namespace, horizontalpodautoscaler) &lt;= 0</code></td><td>您需要在阿里云Prometheus启用<code>horizontalpodautoscaler</code>相关指标（默认关闭）。此指标为免费指标。</td><td>请检查HPA策略是否符合预期。</td></tr></tbody></table><hr><p><strong>说明</strong>：</p><ul class="lvl-0"><li class="lvl-2"><p>规则说明中的操作入口指报警配置页面的报警规则管理页签。您可以登录容器服务管理控制台，在集群列表页面，单击目标集群名称，然后在左侧导航栏，选择报警配置。在报警配置页面，单击报警规则管理页签，进行对应报警规则的更新。</p></li><li class="lvl-2"><p>85%的默认阈值为推荐的参考值，实际取值可以以您的业务情况为准。</p></li><li class="lvl-2"><p>针对某些报警规则，可能需要根据实际情况调整PromQL配置中的参数，以适应不同的监控需求。</p></li></ul><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/best-practices-for-configuring-alert-rules-in-prometheus#p-zyd-s4g-kem">使用Prometheus配置报警规则的最佳实践</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node_exporter添加访问验证</title>
      <link href="/posts/3b0a5d69/"/>
      <url>/posts/3b0a5d69/</url>
      
        <content type="html"><![CDATA[<p>假设你想要求所有访问<code>Prometheus</code>实例的用户提供用户名和密码。为了这个例子，使用<code>admin</code>作为用户名，并选择任何你喜欢的密码。</p><h1>步骤1：密码哈希</h1><p>首先，生成密码的<code>bcrypt</code>哈希值。为了生成哈希密码，我们将使用python3-bcrypt。让我们通过运行apt install python3-bcrypt来安装它，假设你正在运行类似<code>debian</code>的发行版。其他替代方案也存在来生成哈希密码；为了测试，你也可以使用网上的bcrypt生成器。</p><p>这里是一个使用<code>python3-bcrypt</code>的<code>python</code>脚本，它会提示你输入密码并对其进行哈希处理：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line"><span class="keyword">import</span> bcrypt</span><br><span class="line"><span class="comment"># 提示输入密码</span></span><br><span class="line">password = getpass.getpass(<span class="string">&quot;password: &quot;</span>)</span><br><span class="line">hashed_password = bcrypt.hashpw(password.encode(<span class="string">&quot;utf-8&quot;</span>), bcrypt.gensalt())</span><br><span class="line"><span class="comment"># 获取密码的哈希值</span></span><br><span class="line"><span class="built_in">print</span>(hashed_password.decode())</span><br></pre></td></tr></table></figure><h1>步骤2：创建web.yml</h1><p>让我们创建一个<code>web.yml</code>文件，内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">basic_auth_users:</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="string">$2b$12$hNf2lSsxfm0.i4a.1kVpSOVyBCfIB51VRjgBUyv6kdnyTlgWj81Ay</span></span><br></pre></td></tr></table></figure><blockquote><p>注意用户名:【空格】密码</p></blockquote><p>你可以使用<code>promtool check web-config web.yml</code>来验证该文件</p><h1>步骤3：启动Prometheus</h1><p>你可以使用<code>web</code>配置文件来启动<code>prometheus</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ prometheus --web.config.file=web.yml</span><br></pre></td></tr></table></figure><h1>步骤4：测试</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -u admin http://localhost:9090/metrics</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>（可选）步骤5：node_exporter以docker的方式运行</h1><p>在原有运行容器的命令中加上<code>--web.config.file=/xxx/xxx/web.yml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原有命令</span></span><br><span class="line">docker run -d   --net=<span class="string">&quot;host&quot;</span>   --pid=<span class="string">&quot;host&quot;</span>   -v <span class="string">&quot;/:/host:ro,rslave&quot;</span> --name prom-node  quay.io/prometheus/node-exporter:latest   --path.rootfs=/host</span><br><span class="line"><span class="comment"># 启用验证命令</span></span><br><span class="line">docker run -d   --net=<span class="string">&quot;host&quot;</span>   --pid=<span class="string">&quot;host&quot;</span>   -v <span class="string">&quot;/:/host:ro,rslave&quot;</span> --name prom-node  quay.io/prometheus/node-exporter:latest   --path.rootfs=/host --web.config.file=/host/data/prometheus/config.yml</span><br></pre></td></tr></table></figure><h1>步骤6：在server端的<code>prometheus.yml</code>添加验证信息</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;xxx.xxx.xxx.xxx:9100&#x27;</span>]</span><br><span class="line">    <span class="attr">basic_auth:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">admin</span> <span class="comment"># 用户名</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">xxxx</span> <span class="comment"># 明文密码</span></span><br></pre></td></tr></table></figure><h1>步骤7：测试验证</h1><p>登录到<code>server</code>前台，验证是否能够获取<code>node</code>数据</p><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://prometheus.io/docs/guides/basic-auth/">Securing Prometheus API and UI endpoints using basic auth</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Prometheus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx 代理设置访问密码（不依赖htpasswd工具）</title>
      <link href="/posts/f2baa4c/"/>
      <url>/posts/f2baa4c/</url>
      
        <content type="html"><![CDATA[<h1>Nginx访问密码配置（无需htpasswd）</h1><p>要在Nginx中配置访问密码而不依赖于<code>htpasswd</code>等第三方工具，可以按照以下步骤手动创建密码文件并在Nginx配置中引用它。</p><h2 id="步骤1：创建密码文件">步骤1：创建密码文件</h2><ol><li class="lvl-3"><p><strong>生成加密密码</strong>：使用编程语言或在线工具生成加密密码。例如，使用Python的<code>crypt</code>模块：</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> crypt</span><br><span class="line"><span class="built_in">print</span>(crypt.crypt(<span class="string">&quot;your_password&quot;</span>, <span class="string">&quot;salt&quot;</span>))</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p><strong>保存密码文件</strong>：创建一个文本文件（如<code>passwords</code>），并将加密后的密码保存在其中，格式为：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:$apr1$...$...</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p><strong>存放密码文件</strong>：将<code>passwords</code>文件放置在安全的位置，如<code>/etc/nginx/</code>目录下。</p></li></ol><h2 id="步骤2：编辑Nginx配置文件">步骤2：编辑Nginx配置文件</h2><ol><li class="lvl-3"><p><strong>打开配置文件</strong>：编辑<code>Nginx</code>主配置文件<code>/etc/nginx/nginx.conf</code>或相关虚拟主机配置文件。</p></li><li class="lvl-3"><p><strong>添加认证指令</strong>：在相应的<code>server</code>块或<code>location</code>块中添加以下指令以启用基本认证：</p></li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">auth_basic</span> <span class="string">&quot;Restricted&quot;</span>;</span><br><span class="line">    <span class="attribute">auth_basic_user_file</span> /etc/nginx/passwords;</span><br><span class="line">    <span class="comment"># 其他配置...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>auth_basic &quot;Restricted&quot;</code>;定义了认证提示信息。</p></li><li class="lvl-2"><p><code>auth_basic_user_file</code>指定之前创建的密码文件路径。</p></li></ul><h2 id="步骤3：重新加载">步骤3：重新加载</h2><p>保存配置文件更改后，重启Nginx服务以应用新设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="步骤4：测试访问">步骤4：测试访问</h2><p>尝试访问网站，系统应提示输入用户名和密码。使用在<code>passwords</code>文件中定义的凭据登录，若正确，可正常访问网站。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debian脚本中使用了&amp;&gt;/dev/null，$?总是返回0</title>
      <link href="/posts/78eb14d2/"/>
      <url>/posts/78eb14d2/</url>
      
        <content type="html"><![CDATA[<h1>一、问题现象</h1><p>在<code>CentOS</code>中编写了一段<code>Shell</code>脚本，作用很简单，就是监控nginx的配置文件是否发生了变化，如果发生了变化就自动<code>reload</code>一次，脚本如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  md5=`<span class="built_in">md5sum</span> /etc/nginx/conf.d/port-to-domain.conf | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">  grep <span class="variable">$&#123;md5&#125;</span> /tmp/md5result &amp;&gt;/dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Config File Change&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec&#x27;</span></span><br><span class="line">    nginx -t</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec success&#x27;</span></span><br><span class="line">      nginx -s reload</span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -s reload exec&#x27;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Command nginx -t exec failed&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;md5&#125;</span> &gt; /tmp/md5result</span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Change md5result&#x27;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">date</span>` <span class="string">&#x27;Config File NoChange&#x27;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>在<code>CentOS</code>中运行一切正常，但是在Debian中运行异常，具体是<code>grep $&#123;md5&#125; /tmp/md5result &amp;&gt;/dev/null</code>的返回值总是0</p><ul class="lvl-0"><li class="lvl-2"><p>Centos执行过程</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 ~]<span class="comment"># sh -x monitor.sh </span></span><br><span class="line">+ <span class="literal">true</span></span><br><span class="line">++ <span class="built_in">md5sum</span> /etc/nginx/conf.d/port-to-domain.conf</span><br><span class="line">++ awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">+ md5=37e9863c68386613dd0ee4b3a5183380</span><br><span class="line">+ grep 37e9863c68386613dd0ee4b3a5183380 /tmp/md5result</span><br><span class="line">+ <span class="string">&#x27;[&#x27;</span> 1 -ne 0 <span class="string">&#x27;]&#x27;</span> <span class="comment"># 正常返回非0值</span></span><br><span class="line">+ <span class="built_in">echo</span> <span class="string">&#x27;Config File Change&#x27;</span></span><br><span class="line">Config File Change</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Debian系统执行过程</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@cd3b9bf29db3:/<span class="comment"># sh -x monitor.sh </span></span><br><span class="line">+ <span class="literal">true</span></span><br><span class="line">+ <span class="built_in">md5sum</span> /etc/nginx/conf.d/port-to-domain.conf</span><br><span class="line">+ awk &#123;<span class="built_in">print</span> <span class="variable">$1</span>&#125;</span><br><span class="line">+ md5=bca7fa98ab245fa12a4a70a9b15e8b9a</span><br><span class="line">+ </span><br><span class="line">+ [ 0 -ne 0 ]  <span class="comment"># 结果返回0，即使/tmp/md5result不存在也返回0</span></span><br><span class="line">+ grep bca7fa98ab245fa12a4a70a9b15e8b9a /tmp/md5result</span><br><span class="line">+ <span class="built_in">date</span></span><br><span class="line">+ <span class="built_in">echo</span> Mon Sep 30 09:21:43 UTC 2024 Config File NoChange</span><br></pre></td></tr></table></figure><h1>二、问题排查</h1><ul class="lvl-0"><li class="lvl-2"><p>我在Debian的命令行手动执行以上命令，均无问题。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@cd3b9bf29db3:/<span class="comment"># md5=`md5sum /etc/nginx/conf.d/port-to-domain.conf | awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line">root@cd3b9bf29db3:/<span class="comment"># grep $&#123;md5&#125; /tmp/md5result &amp;&gt;/dev/null</span></span><br><span class="line">root@cd3b9bf29db3:/<span class="comment"># echo $?</span></span><br><span class="line">2 <span class="comment"># 返回正常</span></span><br><span class="line">root@cd3b9bf29db3:/<span class="comment">#  </span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>尝试将<code>&amp;&gt;/dev/null</code>删除掉，再测试，发现正常了，不知道是啥原因导致的异常。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@cd3b9bf29db3:/<span class="comment"># sh -x monitor.sh </span></span><br><span class="line">+ <span class="literal">true</span></span><br><span class="line">+ <span class="built_in">md5sum</span> /etc/nginx/conf.d/port-to-domain.conf</span><br><span class="line">+ awk &#123;<span class="built_in">print</span> <span class="variable">$1</span>&#125;</span><br><span class="line">+ md5=bca7fa98ab245fa12a4a70a9b15e8b9a</span><br><span class="line">+ grep bca7fa98ab245fa12a4a70a9b15e8b9a /tmp/md5result</span><br><span class="line">grep: /tmp/md5result: No such file or directory</span><br><span class="line">+ [ 2 -ne 0 ] <span class="comment"># 返回值正常了</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>我尝试修改了运行脚本的方式，从<code>sh scritp.sh</code> 修改为<code>bash script.sh</code>，结果成功了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@cd3b9bf29db3:/<span class="comment"># echo &gt; /tmp/md5result </span></span><br><span class="line"><span class="comment"># bash 与预期相符</span></span><br><span class="line">root@cd3b9bf29db3:/<span class="comment"># bash monitor.sh </span></span><br><span class="line">Mon Sep 30 09:48:11 UTC 2024 Config File Change</span><br><span class="line">Mon Sep 30 09:48:11 UTC 2024 Command nginx -t <span class="built_in">exec</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line">Mon Sep 30 09:48:11 UTC 2024 Command nginx -t <span class="built_in">exec</span> success</span><br><span class="line">2024/09/30 09:48:11 [notice] 592<span class="comment">#592: signal process started</span></span><br><span class="line">Mon Sep 30 09:48:11 UTC 2024 Command nginx -s reload <span class="built_in">exec</span></span><br><span class="line">Mon Sep 30 09:48:11 UTC 2024 Change md5result</span><br><span class="line">Mon Sep 30 09:48:16 UTC 2024 Config File NoChange</span><br><span class="line">^C</span><br><span class="line">root@cd3b9bf29db3:/<span class="comment"># echo 1 &gt; /tmp/md5result </span></span><br><span class="line"><span class="comment"># sh 与预期不相符</span></span><br><span class="line">root@cd3b9bf29db3:/<span class="comment"># sh monitor.sh </span></span><br><span class="line">Mon Sep 30 09:48:38 UTC 2024 Config File NoChange</span><br><span class="line">Mon Sep 30 09:48:43 UTC 2024 Config File NoChange</span><br></pre></td></tr></table></figure><h1>三、结论</h1><blockquote><p>这个结论是问AI的您遇到的问题很可能是由于sh和bash在处理某些命令或脚本构造时的行为差异所致。在Linux系统中，sh通常指的是POSIX shell，而bash是Bourne Again SHell的简称，它是GNU项目的一个兼容sh的shell程序，提供了许多sh没有的特性和改进。</p></blockquote><p><strong>为啥CentOS可以，Debian不行?</strong><br>应该是sh的版本等不同造成的。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用docker安装webssh</title>
      <link href="/posts/e0c5f301/"/>
      <url>/posts/e0c5f301/</url>
      
        <content type="html"><![CDATA[<blockquote><p>部署webssh，可以实现使用浏览器ssh登录，摆脱工具的限制</p></blockquote><h1>部署</h1><ul class="lvl-0"><li class="lvl-2"><p>docker运行</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --log-driver json-file --log-opt max-file=1 --log-opt max-size=100m -p 8032:5032 --restart always --name webssh -e TZ=Asia/Shanghai -e authInfo=用户名:密码 -e savePass=<span class="literal">false</span> jrohy/webssh</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>支持添加的环境变量：</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">port: web使用端口, 默认5032</span><br><span class="line">savePass: 是否保存密码, 默认true</span><br><span class="line">authInfo: 开启账号密码登录验证, &#x27;user:pass&#x27;的格式设置</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>打开网页<br><img src="/img/webssh2.png" alt="webssh"></p></li></ul><h1>nginx反向代理(可选)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">map <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">    default keep-alive;</span><br><span class="line">    <span class="string">&#x27;websocket&#x27;</span> upgrade;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    client_max_body_size 1024m;</span><br><span class="line">    server_name     webssh.域名.top;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header        Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_pass      http://0.0.0.0:8032; <span class="comment"># 转发</span></span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;  <span class="comment">#获取客户端真实IP</span></span><br><span class="line">        proxy_set_header REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        add_header Access-Control-Allow-Origin *;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitpage 套上 cloudflare后显示过多重定向问题解决</title>
      <link href="/posts/6c7d376/"/>
      <url>/posts/6c7d376/</url>
      
        <content type="html"><![CDATA[<h1>一、现象</h1><p>在<code>cloudflare</code>设置好dns之后，gitpage页面无法打开，显示<strong>将您重定向的次数过多</strong></p><h1>二、解决办法</h1><p>在<code>cloudflare</code>的<code>SSL/TLS</code> &gt; <code>概述</code>中，将<code>SSL/TLS加密</code>修改为灵活即可。</p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenEuler 安装MySql</title>
      <link href="/posts/b5a91e2c/"/>
      <url>/posts/b5a91e2c/</url>
      
        <content type="html"><![CDATA[<p><strong>安装mysql</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server -y</span><br></pre></td></tr></table></figure><p><strong>初始化</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --console</span><br></pre></td></tr></table></figure><p><strong>目录授权</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R mysql:mysql /var/lib/mysql/</span><br></pre></td></tr></table></figure><blockquote><p>注意，如果在/etc/my.cnf.d/my.cnf中修改了目录路径，需要对相关路径进行权限修改。</p></blockquote><p><strong>设置登录密码</strong></p><ul class="lvl-0"><li class="lvl-2"><p>修改配置</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="comment">#在mysqld模块下添加</span></span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>重启服务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>进入数据库</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 在提示密码时直接按回车</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>在数据库中刷新权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>修改密码</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;newpassword&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>删除配置</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="comment">#在mysqld模块下删除</span></span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>重启服务就可以使用密码登录了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openEuler开启kdump失败</title>
      <link href="/posts/1c033694/"/>
      <url>/posts/1c033694/</url>
      
        <content type="html"><![CDATA[<h1>一、现象</h1><p>openEuler启动kdump失败，显示<code>No memory reserved for crash kernel</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># systemctl status kdump</span></span><br><span class="line"> kdump.service - Crash recovery kernel arming</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/kdump.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: failed (Result: exit-code) since Mon 2024-06-24 14:50:48 CST; 26min ago</span><br><span class="line">    Process: 1004 ExecStart=/usr/bin/kdumpctl start (code=exited, status=1/FAILURE)</span><br><span class="line">   Main PID: 1004 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Jun 24 14:50:47 kvm-hkcloud01 systemd[1]: Starting Crash recovery kernel arming...</span><br><span class="line">Jun 24 14:50:48 kvm-hkcloud01 kdumpctl[1015]: No memory reserved <span class="keyword">for</span> crash kernel</span><br><span class="line">Jun 24 14:50:48 kvm-hkcloud01 kdumpctl[1015]: Starting kdump: [FAILED]</span><br><span class="line">Jun 24 14:50:48 kvm-hkcloud01 systemd[1]: kdump.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Jun 24 14:50:48 kvm-hkcloud01 systemd[1]: kdump.service: Failed with result <span class="string">&#x27;exit-code&#x27;</span>.</span><br><span class="line">Jun 24 14:50:48 kvm-hkcloud01 systemd[1]: Failed to start Crash recovery kernel arming.</span><br></pre></td></tr></table></figure><h1>二、问题分析</h1><p>根据提示来看，应该是申请不到内存导致的，但从<code>free</code>的结果来看，是可以满足kdump的要求的</p><ul class="lvl-0"><li class="lvl-2">资源剩余700M+</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           967Mi        89Mi       442Mi        23Mi       436Mi       715Mi</span><br><span class="line">Swap:             0B          0B          0B</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">kdump的需求是512M</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># cat /proc/cmdline</span></span><br><span class="line">BOOT_IMAGE=/boot/vmlinuz-5.10.0-136.12.0.86.oe2203sp1.x86_64 root=UUID=d372d015-87b7-44ed-9860-33c9d47eedb6 ro cgroup_disable=files apparmor=0 crashkernel=512M</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>为什么会分配不到资源呢？难道是启动期间资源不足导致？</strong></p><p>接下来我将crash的内存修改为128M，发现可以启动成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前配置</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># cat /etc/default/grub</span></span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=<span class="string">&quot;<span class="subst">$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)</span>&quot;</span></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=<span class="literal">true</span></span><br><span class="line">GRUB_TERMINAL_OUTPUT=<span class="string">&quot;console&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;cgroup_disable=files apparmor=0 crashkernel=512M&quot;</span></span><br><span class="line">GRUB_DISABLE_RECOVERY=<span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="comment"># 修改为128</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># sed -i &#x27;s/512/128/g&#x27; /etc/default/grub</span></span><br><span class="line"><span class="comment"># 重新生成grub.cfg</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-5.10.0-136.12.0.86.oe2203sp1.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-5.10.0-136.12.0.86.oe2203sp1.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-7c27015c30d4409fb116e3795e6126c4</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-7c27015c30d4409fb116e3795e6126c4.img</span><br><span class="line">Adding boot menu entry <span class="keyword">for</span> UEFI Firmware Settings ...</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># 重启主机</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># reboot</span></span><br><span class="line"><span class="comment"># 查看服务</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># systemctl status kdump</span></span><br><span class="line">● kdump.service - Crash recovery kernel arming</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/kdump.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (exited) since Wed 2024-06-26 10:25:09 CST; 1min 12s ago</span><br><span class="line">    Process: 1002 ExecStart=/usr/bin/kdumpctl start (code=exited, status=0/SUCCESS)</span><br><span class="line">   Main PID: 1002 (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">Jun 26 10:25:03 kvm-hkcloud01 systemd[1]: Starting Crash recovery kernel arming...</span><br><span class="line">Jun 26 10:25:09 kvm-hkcloud01 kdumpctl[1009]: kexec: loaded kdump kernel</span><br><span class="line">Jun 26 10:25:09 kvm-hkcloud01 kdumpctl[1009]: Starting kdump: [OK]</span><br><span class="line">Jun 26 10:25:09 kvm-hkcloud01 systemd[1]: Finished Crash recovery kernel arming.</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment">#</span></span><br><span class="line"><span class="comment"># 查看内存，可以看到内存的总量比之前少了128M，说明128M的内存已经分配给crash了。</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           839Mi        85Mi       559Mi       6.2Mi       195Mi       623Mi</span><br><span class="line">Swap:             0B          0B          0B</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>不能分配太少的内存，如果内存太少，会有<code> Could not find a free area of memory of 0x1ddd000 bytes...</code>错误，可以通过<code> makedumpfile --mem-usage /proc/kcore</code>来估算需要多少内存。</p></blockquote><h1>结论</h1><p>虚拟机内存少，而crash设置的内存比较多，会出现因资源不足没办法给crash分配内存的情况，导致kdump启动失败，可以通过修改crash内存参数来解决。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openEuler </tag>
            
            <tag> kdump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux重装系统后恢复LVM</title>
      <link href="/posts/1208ed6f/"/>
      <url>/posts/1208ed6f/</url>
      
        <content type="html"><![CDATA[<p>最近重装了操作系统，仅格式化了操作系统盘，数据盘没有动，因为数据盘之前使用<code>lvm</code>进行管理的，不能直接挂在，要先恢复<code>lvm</code>信息才能挂载。</p><blockquote><p>恢复的前提是要知道vg的名称！！！</p></blockquote><p>步骤如下：</p><ul class="lvl-0"><li class="lvl-2"><p>扫描和识别<code>pv</code>信息</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># pvscan</span></span><br><span class="line">  PV /dev/vdb   VG vg_data         lvm2 [&lt;30.00 GiB / 1020.00 MiB free]</span><br><span class="line">  Total: 1 [&lt;30.00 GiB] / <span class="keyword">in</span> use: 1 [&lt;30.00 GiB] / <span class="keyword">in</span> no VG: 0 [0   ]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>激活vg（前提是要知道vg的名称）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># vgchange -ay vg_data</span></span><br><span class="line">  1 logical volume(s) <span class="keyword">in</span> volume group <span class="string">&quot;vg_data&quot;</span> now active</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>查看是否有<code>lv</code>数据</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg_data/lv_data</span><br><span class="line">  LV Name                lv_data</span><br><span class="line">  VG Name                vg_data</span><br><span class="line">  LV UUID                JJOdQt-2l5h-fEHJ-MkIo-bwG3-G3YV-mfjz72</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time kvm-hkcloud01.local, 2024-02-23 11:41:13 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line">  LV Size                29.00 GiB</span><br><span class="line">  Current LE             7424</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           252:0</span><br><span class="line"></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>挂载</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># mount /dev/mapper/vg_data-lv_data /data</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem                   Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                     4.0M     0  4.0M   0% /dev</span><br><span class="line">tmpfs                        484M     0  484M   0% /dev/shm</span><br><span class="line">tmpfs                        194M  5.4M  189M   3% /run</span><br><span class="line">tmpfs                        4.0M     0  4.0M   0% /sys/fs/cgroup</span><br><span class="line">/dev/vda1                     50G  1.8G   46G   4% /</span><br><span class="line">tmpfs                        484M     0  484M   0% /tmp</span><br><span class="line">/dev/mapper/vg_data-lv_data   29G  3.4G   26G  12% /data</span><br></pre></td></tr></table></figure><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href=""></a></p></li><li class="lvl-2"><p><a href=""></a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 文件系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux中sysrq-trigger的妙用</title>
      <link href="/posts/c0f21a4/"/>
      <url>/posts/c0f21a4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>sysrq被称为魔术组合键，只要内核没有完全锁住，不管内核在做什么事情，使用这些组合键都可以搜集包括系统内存使用、CPU任务处理、进程运行状态等系统运行信息。 注意：信息的输出都在/var/log/message下</p></blockquote><p>Linux如何模拟崩溃？如何强制关机？这时候就可以使用到本文提到的<code>/proc/sysrq-trigger</code>文件了。</p><ul class="lvl-0"><li class="lvl-2"><p>故意让系统崩溃，注意这不是重启，崩溃后只能从进行硬重启才能重连上系统。（产生空指针paincz事件，触发kdump，收集vmcore，会在/var/crash目录生成）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;c&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>立即重新启动计算机</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;b&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>立即关闭计算机</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;o&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>导出内存分配的信息 （可以用/var/log/message 查看）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;m&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>导出当前CPU寄存器信息和标志位的信息</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;p&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>导出线程状态信息</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;t&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>故意让系统溃</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;c&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>立即重新挂载所有的文件系统</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;s&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>立即重新挂载所有的文件系统为只读</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;u&quot;</span> &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><p>为了安全起见，在红帽企业版Linux里面，默认SysRq组合键是关闭的。 打开这个功能，运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/sysrq</span><br></pre></td></tr></table></figure><p>关闭这个功能：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/sysrq</span><br></pre></td></tr></table></figure><p>如果想让此功能一直生效，在/etc/sysctl.conf里面设置kernel.sysrq的值为1. 重新启动以后，此功能将会自动打开。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jquery禁用按钮，防止重复提交</title>
      <link href="/posts/17c655b1/"/>
      <url>/posts/17c655b1/</url>
      
        <content type="html"><![CDATA[<p>使用<code>对象.prop(&quot;disabled&quot;,true)</code>可以进行禁用，<code>对象.prop(&quot;disabled&quot;,false)</code>取消禁用。</p><ul class="lvl-0"><li class="lvl-2">html代码如下</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;editEventForm&quot;</span> <span class="attr">novalidate</span>=<span class="string">&quot;novalidate&quot;</span>&gt;</span></span><br><span class="line">.....</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:history.go(-1);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success float-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary float-right&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-right:5px;&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">js代码</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&quot;#editEventForm button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">            $(<span class="string">&quot;#editEventForm button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">prop</span>(<span class="string">&quot;disabled&quot;</span>,<span class="literal">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>注意：如果您的提交按钮设置了ID，可以使用$(“#ID名称”).prop(“disabled”,true)来操作，这样就不用写这么长了。</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>可以在提交成功或失败后，执行取消禁用</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#editEventForm button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">prop</span>(<span class="string">&quot;disabled&quot;</span>,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><h2 id="参考资料">参考资料</h2><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href=""></a></p></li><li class="lvl-2"><p><a href=""></a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>systemd怎么查看开机自启动服务</title>
      <link href="/posts/614dd6d8/"/>
      <url>/posts/614dd6d8/</url>
      
        <content type="html"><![CDATA[<p>在CentOS 7及更高的版本中，使用<code>chkconfig</code>命令查看开机自启动信息时，发现只有几个服务被<code>SysV</code>管理的服务，没有包括<code>systemd</code>管理的服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 var]<span class="comment"># chkconfig --list</span></span><br><span class="line"></span><br><span class="line">Note: This output shows SysV services only and does not include native</span><br><span class="line">      systemd services. SysV configuration data might be overridden by native</span><br><span class="line">      systemd configuration.</span><br><span class="line"></span><br><span class="line">      If you want to list systemd services use <span class="string">&#x27;systemctl list-unit-files&#x27;</span>.</span><br><span class="line">      To see services enabled on particular target use</span><br><span class="line">      <span class="string">&#x27;systemctl list-dependencies [target]&#x27;</span>.</span><br><span class="line"></span><br><span class="line">netconsole      0:off   1:off   2:off   3:off   4:off   5:off   6:off</span><br><span class="line">network         0:off   1:off   2:on    3:on    4:on    5:on    6:off</span><br><span class="line">[root@kvm-hkcloud01 var]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>如果需要查看被<code>systemd</code>管理的服务，可以使用以下命令进行查询。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 var]<span class="comment"># systemctl list-unit-files</span></span><br></pre></td></tr></table></figure><p>更多systemd内容，可参考<a href="https://ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">https://ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux文件的ACL</title>
      <link href="/posts/de677c90/"/>
      <url>/posts/de677c90/</url>
      
        <content type="html"><![CDATA[<p>在Linux中，一般使用<code>chmod</code>命令对属主、用户组、其它用户为类别对文件权限进行控制，这种方式较为粗略，但也能满足日常需求。在一些特殊的场景中，如只允许某些用户能访问文件的场景，如果使用<code>chmod</code>命令进行配置，一般是将这部分用户加入到组中，然后配置组的权限。</p><p>在Linux中，还提供了一种精细化的文件权限控制方式，那就是ACL（Access Control List）</p><blockquote><p>在没有ACL技术之前,Linux系统对文件的权限控制仅可划分文件的属主、用户组、其他用户三类,随着技术的发展,传统的文件权限控制已经无法适应复杂场景下的权限控制需求,比如说一个部门(即一个用户组group)存在有多名员工(即用户,user01、user02…),针对于部门内不同职责的员工,会为其赋予不同的权限,如为user01赋予可读写权限,为user02赋予只读权限,不为user03赋予任何权限,此时由于这些员工属于同一部门,就无法为这些不同的员工进行权限的细化。为此ACL(Access Control List)访问控制列表技术应运而生,使用ACL权限控制可以提供常见权限(如rwx、ugo)权限之外的权限设,置,可以针对单一用户或组来设置特定的权限。</p></blockquote><p>使用ACL必须要有文件系统的支持，目前ext3/ext4/xfs/zfs都支持文件ACL。</p><h1>相关命令</h1><ul class="lvl-0"><li class="lvl-2"><p>setfacl：设置文件的acl</p></li><li class="lvl-2"><p>getfacl：获取文件的acl</p></li><li class="lvl-2"><p>chacl：更改文件或目录的ACL</p></li></ul><h1>操作实验</h1><h2 id="用户权限配置">用户权限配置</h2><ul class="lvl-0"><li class="lvl-2"><p>user01创建文件并配置600权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># su user01</span></span><br><span class="line">[user01@txy201-51 data]$ <span class="built_in">echo</span> 51yunwei.top &gt; acltest</span><br><span class="line">[user01@txy201-51 data]$ <span class="built_in">chmod</span> 600 acltest</span><br><span class="line">[user01@txy201-51 data]$ getfacl acltest</span><br><span class="line"><span class="comment"># file: acltest</span></span><br><span class="line"><span class="comment"># owner: user01</span></span><br><span class="line"><span class="comment"># group: user01</span></span><br><span class="line">user::rw-</span><br><span class="line">group::---</span><br><span class="line">other::---</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>测试user02有没有访问权限（无）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># su user02</span></span><br><span class="line">[user02@txy201-51 data]$ <span class="built_in">cat</span> acltest</span><br><span class="line"><span class="built_in">cat</span>: acltest: 权限不够</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>使用setfacl给user02配置权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[user01@txy201-51 data]$ setfacl -m user02:r acltest</span><br><span class="line">[user01@txy201-51 data]$ getfacl acltest</span><br><span class="line"><span class="comment"># file: acltest</span></span><br><span class="line"><span class="comment"># owner: user01</span></span><br><span class="line"><span class="comment"># group: user01</span></span><br><span class="line">user::rw-</span><br><span class="line">user:user02:r--</span><br><span class="line">group::---</span><br><span class="line">mask::r--</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>user02测试是否能读（可以）、写文件（不可以）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># su user02</span></span><br><span class="line">[user02@txy201-51 data]$ <span class="built_in">cat</span> acltest</span><br><span class="line">51yunwei.top</span><br><span class="line">[user02@txy201-51 data]$ <span class="built_in">echo</span> www.51yunwei.top &gt;&gt; acltest</span><br><span class="line">bash: acltest: 权限不够</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>修改user02的权限为读写</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># setfacl -m user02:rw acltest</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># su user02</span></span><br><span class="line">[user02@txy201-51 data]$ <span class="built_in">echo</span> www.51yunwei.top &gt;&gt; acltest</span><br><span class="line">[user02@txy201-51 data]$ <span class="built_in">cat</span> acltest</span><br><span class="line">51yunwei.top</span><br><span class="line">www.51yunwei.top</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>删除权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># setfacl -x user02 acltest</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># getfacl acltest</span></span><br><span class="line"><span class="comment"># file: acltest</span></span><br><span class="line"><span class="comment"># owner: user01</span></span><br><span class="line"><span class="comment"># group: user01</span></span><br><span class="line">user::rw-</span><br><span class="line">group::---</span><br><span class="line">mask::r--</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><h2 id="组权限">组权限</h2><p>setfacl默认对用户acl进行管理，如果要为组设置acl，只需要加上一个组的标识<code>g:</code>即可。</p><ul class="lvl-0"><li class="lvl-2"><p>当前user03没有访问权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># id user03</span></span><br><span class="line">uid=1005(user03) gid=1006(user03) 组=1006(user03),1004(user01)</span><br><span class="line">[root@txy201-51 data]<span class="comment"># su user03</span></span><br><span class="line">[user03@txy201-51 data]$ <span class="built_in">cat</span> acltest</span><br><span class="line"><span class="built_in">cat</span>: acltest: 权限不够</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>给user01组设置权限后，user03就能访问文件了（user03也在user01组）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># setfacl -m g:user01:r acltest</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># su user03</span></span><br><span class="line">[user03@txy201-51 data]$ <span class="built_in">cat</span> acltest</span><br><span class="line">51yunwei.top</span><br><span class="line">www.51yunwei.top</span><br></pre></td></tr></table></figure><h1>系统文件权限的备份与恢复</h1><p>在运维过程中，最怕误操作将全局的文件权限给修改了，比如执行了<code>chmod 777 -R /</code>或<code>chown -R user01:user01 /</code>，那如果真的遇到了这种情况我们应该怎么做呢？在日常运维中，我们可以把系统权限信息进行备份，在必要时进行恢复。</p><ul class="lvl-0"><li class="lvl-2"><p>备份文件权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getfacl -p &gt; 备份文件</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>恢复文件权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl --restore=备份的文件</span><br></pre></td></tr></table></figure><h2 id="实战篇">实战篇</h2><ul class="lvl-0"><li class="lvl-2"><p>实验目录<code>/tmp/data</code>，文件结构如下</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># ls -lR</span></span><br><span class="line">.:</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r-----+ 1 user01 user01   30 6月  20 16:13 acltest</span><br><span class="line">drwxr-xr-x  2 root   root   4096 6月  20 16:30 yunwei</span><br><span class="line"></span><br><span class="line">./yunwei:</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 51yunwei</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 top</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 www</span><br><span class="line">[root@txy201-51 data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>将目录的权限备份到<code>tmp_data_acl.bak下</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># getfacl -R -p /tmp/data &gt; tmp_data_acl.bak</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>模拟误操作，修改目录下的所有权限和属主</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># chown user01:user01 -R /tmp/data</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># chmod 400 -R /tmp/data</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># ls -lR</span></span><br><span class="line">.:</span><br><span class="line">总用量 12</span><br><span class="line">-r--------+ 1 user01 user01   30 6月  20 16:13 acltest</span><br><span class="line">-r--------  1 user01 user01  670 6月  20 17:24 tmp_data_acl.bak</span><br><span class="line">dr--------  2 user01 user01 4096 6月  20 16:30 yunwei</span><br><span class="line"></span><br><span class="line">./yunwei:</span><br><span class="line">总用量 0</span><br><span class="line">-r-------- 1 user01 user01 0 6月  20 16:30 51yunwei</span><br><span class="line">-r-------- 1 user01 user01 0 6月  20 16:30 top</span><br><span class="line">-r-------- 1 user01 user01 0 6月  20 16:30 www</span><br><span class="line">[root@txy201-51 data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>恢复权限，可以看到权限已恢复正常。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 data]<span class="comment"># setfacl --restore=tmp_data_acl.bak</span></span><br><span class="line">[root@txy201-51 data]<span class="comment"># ls -lR</span></span><br><span class="line">.:</span><br><span class="line">总用量 12</span><br><span class="line">-rw-rw----+ 1 user01 user01   30 6月  20 16:13 acltest</span><br><span class="line">-rw-r--r--  1 root   root    670 6月  20 17:24 tmp_data_acl.bak</span><br><span class="line">drwxr-xr-x  2 root   root   4096 6月  20 16:30 yunwei</span><br><span class="line"></span><br><span class="line">./yunwei:</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 51yunwei</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 top</span><br><span class="line">-rw-r--r-- 1 root root 0 6月  20 16:30 www</span><br><span class="line">[root@txy201-51 data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><blockquote><p>如果没有提前备份的话，可以同其它相同系统做一次备份，将文件拷贝过来做恢复，对于没在备份中的文件，权限不会被修改。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 权限 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux中的用户ID会不会重复？</title>
      <link href="/posts/a0e0543a/"/>
      <url>/posts/a0e0543a/</url>
      
        <content type="html"><![CDATA[<p><code>UID</code>指的是用户的<code>ID</code>(User ID)，一个用户的UID标识一个给定用户，UID是用户的唯一标识符，通过UID可以区分不同的用户类别，比如UID为0的是超级用户，UID为1000-600000之间的是普通用户，而UID为1-999之间的是虚拟用户。</p><ul class="lvl-0"><li class="lvl-2">超级用户：也称为root用户，UID为0，拥有系统的完全控制权限，可以进行修改、删除文件等操作。</li><li class="lvl-2">普通用户：也成为一般用户，UID为1000-60000之间，可以对自己目录下的文件进行访问和修改，也可以对经过授权的文件进行访问。</li><li class="lvl-2">虚拟用户：也称为系统用户，UID为1-999之间，不提供密码登录系统，它们的存在主要是为了方便系统的管理。</li></ul><p>Linux中的用户ID会不会重复？会，可以人为将多个不用户的ID配置为重复的ID。</p><p><strong>用户在登录系统时，是通过UID来区分用户，而不是通过用户名来区分</strong><br>实验步骤：<br>1、创建一个UID为1000的用户user02，再创建一个相同id的user01，通过id命令，发现两个用户都显示为user02</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># useradd -u 1000 user02</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># useradd -u 1000 -o user01</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user01</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user02</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br></pre></td></tr></table></figure><p>2、切换到user01下，发现名称还是user02，但是组信息变为了user01的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># su - user01</span></span><br><span class="line">Last login: Tue Jun 18 11:35:27 CST 2024 on pts/0</span><br><span class="line">[user02@kvm-hkcloud01 ~]$ <span class="built_in">id</span></span><br><span class="line">uid=1000(user02) gid=1003(user01) <span class="built_in">groups</span>=1003(user01)</span><br><span class="line">[user02@kvm-hkcloud01 ~]$</span><br></pre></td></tr></table></figure><p>3、当user02的uid发生改变时，再查看user01的信息，因为没有重复的id的情况下，用户名就能正常的显示user01了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># usermod -u 1001 user02</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user02</span></span><br><span class="line">uid=1001(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user01</span></span><br><span class="line">uid=1000(user01) gid=1003(user01) <span class="built_in">groups</span>=1003(user01)</span><br></pre></td></tr></table></figure><p>4、当我再将user02的uid修改为1000的时候，再查看user01的信息，发现user01的用户名又显示为user02了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># usermod -u 1000 -o user02</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user02</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user01</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br></pre></td></tr></table></figure><p><strong>那么，当UID重复的时候，是谁决定了用哪个用户名作为显示呢？</strong><br>想一想，哪个文件记录了UID信息？没错,是<code>/etc/passwd</code>当我将user01和user02的行进行调转之后（user01）在前，使用id查看的时候，显示的用户名就是user01了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改前</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># tail -n 2 /etc/passwd</span></span><br><span class="line">user02:x:1000:1002::/home/user02:/bin/bash</span><br><span class="line">user01:x:1000:1003::/home/user01:/bin/bash</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user01</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user02</span></span><br><span class="line">uid=1000(user02) gid=1002(user02) <span class="built_in">groups</span>=1002(user02)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># vi /etc/passwd</span></span><br><span class="line"><span class="comment"># 修改后</span></span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># tail -n 2 /etc/passwd</span></span><br><span class="line">user01:x:1000:1003::/home/user01:/bin/bash</span><br><span class="line">user02:x:1000:1002::/home/user02:/bin/bash</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user01</span></span><br><span class="line">uid=1000(user01) gid=1003(user01) <span class="built_in">groups</span>=1003(user01)</span><br><span class="line">[root@kvm-hkcloud01 ~]<span class="comment"># id user02</span></span><br><span class="line">uid=1000(user01) gid=1003(user01) <span class="built_in">groups</span>=1003(user01)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>怎么判断多台虚拟机上的磁盘是不是同一块磁盘呢？</title>
      <link href="/posts/b6ae4c2c/"/>
      <url>/posts/b6ae4c2c/</url>
      
        <content type="html"><![CDATA[<p>在虚拟化环境上，有普通磁盘和共享磁盘，有时候进行扩容后，多台虚拟机上的磁盘大小一样，那怎么判断某个盘是不是共享磁盘呢？这时候我们可以使用<code>blkid</code>命令来查看。</p><p>命令输出结果如下，如果多台虚拟机输出的<code>uuid</code>是一样的，那这个磁盘就是共享磁盘了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># blkid /dev/vda1</span></span><br><span class="line">/dev/vda1: UUID=<span class="string">&quot;4b499d76-769a-40a0-93dc-4a31a59add28&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux中的软链接和硬链接</title>
      <link href="/posts/83a68e5f/"/>
      <url>/posts/83a68e5f/</url>
      
        <content type="html"><![CDATA[<p>在Linux中，可以使<code>ln</code>命令创建链接文件，默认是硬链接，如果加<code>-s</code>参数，就是创建软连接。</p><ul class="lvl-0"><li class="lvl-2">软链接：和Windows中的快捷方式差不多，这个链接文件指向源文件，和源文件不同，源文件被删除时，软链接文件无法访问。</li><li class="lvl-2">硬链接：硬链接更像是源文件的副本，这两个文件指向了相同的inode，源文件被删除时，inode的硬链接数不为0，数据不会删除，此时访问硬链接文件正常。</li></ul><h1>一、软链接和硬链接文件信息</h1><p>1、创建链接文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># echo 123 &gt; passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># ln passwd link_h_passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># ln -s passwd link_s_passwd</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、查看源文件信息，inode为51380</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># stat passwd</span></span><br><span class="line">  文件：<span class="string">&quot;passwd&quot;</span></span><br><span class="line">  大小：16              块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd01h/64769d      Inode：51380       硬链接：2</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2024-05-31 15:45:22.174997597 +0800</span><br><span class="line">最近更改：2024-05-31 15:45:21.844997227 +0800</span><br><span class="line">最近改动：2024-05-31 15:45:21.844997227 +0800</span><br><span class="line">创建时间：-</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3、查看硬链接文件，inode也是51380，和源文件指向了相同的inode，而且文件属性为普通文件，而不是链接文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># stat link_h_passwd</span></span><br><span class="line">  文件：<span class="string">&quot;link_h_passwd&quot;</span></span><br><span class="line">  大小：16              块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd01h/64769d      Inode：51380       硬链接：2</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2024-05-31 15:45:22.174997597 +0800</span><br><span class="line">最近更改：2024-05-31 15:45:21.844997227 +0800</span><br><span class="line">最近改动：2024-05-31 15:45:21.844997227 +0800</span><br><span class="line">创建时间：-</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>4、再看看软连接的状态,文件的大小、指向的inode和源文件不同，文件类型为符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># stat link_s_passwd</span></span><br><span class="line">  文件：<span class="string">&quot;link_s_passwd&quot;</span> -&gt; <span class="string">&quot;passwd&quot;</span></span><br><span class="line">  大小：6               块：0          IO 块：4096   符号链接</span><br><span class="line">设备：fd01h/64769d      Inode：51379       硬链接：1</span><br><span class="line">权限：(0777/lrwxrwxrwx)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2024-05-31 15:38:40.578545132 +0800</span><br><span class="line">最近更改：2024-05-31 15:38:39.634544066 +0800</span><br><span class="line">最近改动：2024-05-31 15:38:39.634544066 +0800</span><br><span class="line">创建时间：-</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h1>二、修改源文件，链接文件的变化</h1><p>1、修改源源文件，可以看到软链接和硬链接文件的内容也随之改变了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># echo 456 &gt; passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_s_passwd</span></span><br><span class="line">456</span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_h_passwd</span></span><br><span class="line">456</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、修改软连接文件，可以看到源文件和硬链接文件也都发生了变化，因为软连接就是指向源文件的，可以理解为对源文件的修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># echo 789 &gt; link_s_passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat passwd</span></span><br><span class="line">789</span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_h_passwd</span></span><br><span class="line">789</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>3、修改硬链接文件，可以看到软链接和源文件的数据也发生了变化，因为修改硬链接，实际上修改的是inode块的数据，源文件指向的也是这个数据块，所以内容也会发生变化。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># echo &#x27;abc&#x27; &gt; link_h_passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat passwd</span></span><br><span class="line">abc</span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_s_passwd</span></span><br><span class="line">abc</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h1>三、删除源文件对链接文件的影响</h1><p>1、删除源文件，软链接文件无法访问，硬链接文件访问正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># rm -f passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_s_passwd</span></span><br><span class="line"><span class="built_in">cat</span>: link_s_passwd: 没有那个文件或目录</span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_h_passwd</span></span><br><span class="line">abc</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>2、如果再创建一个和源文件一样的文件，可以看到软链接文件可以正常访问了，但是硬链接的数据和源文件不一致，你知道这是为什么吗？</p><blockquote><p>因为再次创建‘源’文件之后，‘源’文件的inode发生了变化，所以数据肯定不一致。而软连接是对路径的链接，只要这个路径在，就可以访问。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@txy201-51 tmp]<span class="comment"># echo 123 &gt; passwd</span></span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_h_passwd</span></span><br><span class="line">abc</span><br><span class="line">[root@txy201-51 tmp]<span class="comment"># cat link_s_passwd</span></span><br><span class="line">123</span><br><span class="line">[root@txy201-51 tmp]<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openEuler中奇怪的网络管理服务</title>
      <link href="/posts/4cf37030/"/>
      <url>/posts/4cf37030/</url>
      
        <content type="html"><![CDATA[<p>openEuler中的网络服务</p><h1>管理网络服务</h1><p>openEuler没有network服务，当我修改了网卡配置文件之后，使用以下命令进行重启，报错<code>Failed to restart network.service: Unit network.service not found.</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sshuser]<span class="comment"># systemctl restart network</span></span><br><span class="line">Failed to restart network.service: Unit network.service not found.</span><br><span class="line">[root@localhost sshuser]<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>经过查询才知道，<code>EulerOS</code>没有<code>network</code>服务，而是使用<code>NetworkManager</code>管理网络服务，所以直接重启这个服务即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sshuser]<span class="comment"># systemctl restart NetworkManager</span></span><br></pre></td></tr></table></figure><p>让我感觉到奇怪的点是，在系统中是可以查到<code>network</code>服务的，但用<code>systemctl</code>和<code>service</code>命令却管理不了它。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sshuser]<span class="comment"># systemctl | grep network</span></span><br><span class="line">  sys-devices-pci0000:00-0000:00:12.0-virtio1-net-ens18.device                                             loaded active plugged   Virtio network device</span><br><span class="line">  sys-subsystem-net-devices-ens18.device                                                                   loaded active plugged   Virtio network device</span><br><span class="line">  network-online.target                                                                                    loaded active active    Network is Online</span><br><span class="line">  network-pre.target                                                                                       loaded active active    Preparation <span class="keyword">for</span> Network</span><br><span class="line">  network.target                                                                                           loaded active active    Network</span><br><span class="line">[root@localhost sshuser]<span class="comment"># </span></span><br></pre></td></tr></table></figure><h1>修改网卡配置</h1><p>第二个奇怪的点是，修改网卡配置文件，掩码只能使用<code>PEREFIX</code>来表示，不能使用<code>NETMASK</code>，不然IP地址修改不成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IPADDR=192.168.3.138</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.3.1</span><br></pre></td></tr></table></figure><h1>查看IP的命令</h1><p>在<code>openEuler</code>中，除了可以使用<code>ip add</code>命令查看地址外，还可以使用<code>nmcli</code>命令查看，默认自带了这两个命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]<span class="comment"># nmcli dev show</span></span><br><span class="line">GENERAL.DEVICE:                         ens18</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         8E:F7:F5:E9:2A:78</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.STATE:                          100 (connected)</span><br><span class="line">GENERAL.CONNECTION:                     ens18</span><br><span class="line">GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/1</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               on</span><br><span class="line">IP4.ADDRESS[1]:                         192.168.3.138/24</span><br><span class="line">IP4.GATEWAY:                            192.168.3.1</span><br><span class="line">IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 192.168.3.1, mt = 100</span><br><span class="line">IP4.ROUTE[2]:                           dst = 192.168.3.0/24, nh = 0.0.0.0, mt = 100</span><br><span class="line">IP6.ADDRESS[1]:                         2409:8a55:8f2:xxa4:8cf7:fxxf:fxe9:xxx/64</span><br><span class="line">IP6.ADDRESS[2]:                         2409:8a55:8f2:xxa4:d4bb:e68f:cx3x:x/128</span><br><span class="line">IP6.ADDRESS[3]:                         fe80::8cf7:f5ff:fee9:2a78/64</span><br><span class="line">IP6.GATEWAY:                            fe80::1</span><br><span class="line">IP6.ROUTE[1]:                           dst = 2409:8a55:8f2:bca4::/64, nh = ::, mt = 100</span><br><span class="line">IP6.ROUTE[2]:                           dst = ::/0, nh = fe80::1, mt = 100</span><br><span class="line">IP6.ROUTE[3]:                           dst = 2409:8a55:8f2:bca4:d4bb:e68f:cb34:3/128, nh = ::, mt = 100</span><br><span class="line">IP6.ROUTE[4]:                           dst = fe80::/64, nh = ::, mt = 100</span><br><span class="line">IP6.DNS[1]:                             fe80::1</span><br><span class="line"></span><br><span class="line">GENERAL.DEVICE:                         lo</span><br><span class="line">GENERAL.TYPE:                           loopback</span><br><span class="line">GENERAL.HWADDR:                         00:00:00:00:00:00</span><br><span class="line">GENERAL.MTU:                            65536</span><br><span class="line">GENERAL.STATE:                          10 (unmanaged)</span><br><span class="line">GENERAL.CONNECTION:                     --</span><br><span class="line">GENERAL.CON-PATH:                       --</span><br><span class="line">IP4.ADDRESS[1]:                         127.0.0.1/8</span><br><span class="line">IP4.GATEWAY:                            --</span><br><span class="line">IP6.ADDRESS[1]:                         ::1/128</span><br><span class="line">IP6.GATEWAY:                            --</span><br><span class="line">IP6.ROUTE[1]:                           dst = ::1/128, nh = ::, mt = 256</span><br><span class="line">[root@localhost network-scripts]<span class="comment"># </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openEuler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>给hexo主题添加代码块复制功能</title>
      <link href="/posts/6646bad2/"/>
      <url>/posts/6646bad2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>适用于所有的Hexo主题</p></blockquote><h1>创建clipboard_use.js</h1><p>在<code>themes/xxx/source/js</code> 目录下，创建<code>clipboard_use.js</code>，添加内容如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.highlight&quot;</span>).<span class="title function_">wrap</span>(<span class="string">&quot;&lt;div class=&#x27;code-wrapper&#x27; style=&#x27;position:relative&#x27;&gt;&lt;/div&gt;&quot;</span>);</span><br><span class="line"><span class="comment">/*页面载入完成后，创建复制按钮*/</span></span><br><span class="line">!<span class="keyword">function</span> (<span class="params">e, t, a</span>) &#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">    <span class="keyword">var</span> initCopyCode = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> copyHtml = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        copyHtml += <span class="string">&#x27;&lt;button class=&quot;btn-copy&quot; data-clipboard-snippet=&quot;&quot;&gt;&#x27;</span>;</span><br><span class="line">        copyHtml += <span class="string">&#x27;  &lt;i class=&quot;fa fa-clipboard&quot;&gt;&lt;/i&gt;&lt;span&gt;复制&lt;/span&gt;&#x27;</span>;</span><br><span class="line">        copyHtml += <span class="string">&#x27;&lt;/button&gt;&#x27;</span>;</span><br><span class="line">        <span class="comment">/* $(&quot;.highlight .code&quot;).before(copyHtml); */</span></span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.code-wrapper .highlight table&quot;</span>).<span class="title function_">before</span>(copyHtml);</span><br><span class="line">        <span class="keyword">var</span> clipboard = <span class="keyword">new</span> <span class="title class_">ClipboardJS</span>(<span class="string">&#x27;.btn-copy&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">target</span>: <span class="keyword">function</span> (<span class="params">trigger</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> tablee = trigger.<span class="property">nextElementSibling</span>;</span><br><span class="line">               &lt;!--  <span class="keyword">return</span> trigger.<span class="property">nextElementSibling</span>; --&gt;</span><br><span class="line">                <span class="keyword">return</span> tablee.<span class="property">firstElementChild</span>.<span class="property">firstElementChild</span>.<span class="property">firstElementChild</span>.<span class="property">nextElementSibling</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        clipboard.<span class="title function_">on</span>(<span class="string">&#x27;success&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            e.<span class="property">trigger</span>.<span class="property">innerHTML</span> = <span class="string">&quot;&lt;i class=&#x27;fa fa-clipboard&#x27;&gt;&lt;/i&gt;&lt;span&gt;复制成功&lt;/span&gt;&quot;</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                e.<span class="property">trigger</span>.<span class="property">innerHTML</span> = <span class="string">&quot;&lt;i class=&#x27;fa fa-clipboard&#x27;&gt;&lt;/i&gt;&lt;span&gt;复制&lt;/span&gt;&quot;</span></span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">           </span><br><span class="line">            e.<span class="title function_">clearSelection</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">        clipboard.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            e.<span class="property">trigger</span>.<span class="property">innerHTML</span> = <span class="string">&quot;&lt;i class=&#x27;fa fa-clipboard&#x27;&gt;&lt;/i&gt;&lt;span&gt;复制失败&lt;/span&gt;&quot;</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                e.<span class="property">trigger</span>.<span class="property">innerHTML</span> = <span class="string">&quot;&lt;i class=&#x27;fa fa-clipboard&#x27;&gt;&lt;/i&gt;&lt;span&gt;复制&lt;/span&gt;&quot;</span></span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">            e.<span class="title function_">clearSelection</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">initCopyCode</span>();</span><br><span class="line">&#125;(<span class="variable language_">window</span>, <span class="variable language_">document</span>);</span><br></pre></td></tr></table></figure><h1>添加CSS</h1><p>在<code>theme/xxx/source/css/style.css</code>样式中添加如下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 代码块复制按钮 */</span></span><br><span class="line"><span class="selector-class">.btn-copy</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">#fcfcfc</span>, <span class="number">#eee</span>);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d5d5d5</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    -webkit-user-select: none;</span><br><span class="line">    -moz-user-select: none;</span><br><span class="line">    -ms-user-select: none;</span><br><span class="line">    user-select: none;</span><br><span class="line">    -webkit-appearance: none;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    -webkit-<span class="attribute">transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    -o-<span class="attribute">transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    <span class="attribute">transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-copy</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">5px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.code-wrapper</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.btn-copy</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>引入font-awesome</h1><p>按钮上面添加了一个小图标美化，需要引入font-awesome.<br>在<code>themes\xxx\layout\_partial\head.ejs</code>或<code>themes\xxx\layout\_common\head.ejs</code>中的<code>&lt;/head&gt;</code>之前添加</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>引用其他js</h1><p>在<code>themes\xxx\layout\layout.ejs</code>文件中的<code>&lt;/body&gt;</code>标签前也就是<code>body</code>标签之间的最后加入如下代码,这里是将<code>clipboard.min.js</code>和<code>clipboard-use.js</code>保存到CDN上，通过远程引用 或者将他们直接下载到本地直接引用也可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 代码块复制功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/clipboard_use.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>部署</h1><p>最后就可以使用hexo提交就行啦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g -d</span><br></pre></td></tr></table></figure><p>参考资料</p><blockquote><ul class="lvl-1"><li class="lvl-2"><p><a href="https://www.ikaqiu.top/posts/f623adca.html">为Hexo主题增加代码块复制功能</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>当前博客使用主题及部署方式</title>
      <link href="/posts/6646bad1/"/>
      <url>/posts/6646bad1/</url>
      
        <content type="html"><![CDATA[<p>当前使用的主题是<code>Wikitten</code></p><p>部署文档链接如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/zthxxx/hexo-theme-Wikitten/blob/master/README_zh-CN.md</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>清除模态框form的内容</title>
      <link href="/posts/6646bac7/"/>
      <url>/posts/6646bac7/</url>
      
        <content type="html"><![CDATA[<p>在模态框提交数据后，页面不刷新的情况下，再次点击模态框，上次输入的内容还保留着，可以通过下面的方式清除模态框内容</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在ajax返回成功时可以执行</span></span><br><span class="line">$(<span class="string">&#x27;.modal-body&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;form&#x27;</span>).<span class="title function_">trigger</span>(<span class="string">&#x27;reset&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果在用户点击关闭时也要执行，可以在show.bs.modal事件里设置</span></span><br><span class="line"> $(<span class="string">&#x27;#updatemodal&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;show.bs.modal&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal-body&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;form&#x27;</span>).<span class="title function_">trigger</span>(<span class="string">&#x27;reset&#x27;</span>);</span><br><span class="line">    <span class="comment">// 其他内容</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>modal中使用form</title>
      <link href="/posts/6646bac6/"/>
      <url>/posts/6646bac6/</url>
      
        <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>html</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 更新进展Modal --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span> <span class="attr">id</span>=<span class="string">&quot;updatemodal&quot;</span> <span class="attr">data-backdrop</span>=<span class="string">&quot;static&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">role</span>=<span class="string">&quot;dialog&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;staticBackdropLabel&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;updatemodal&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog modal-xl&quot;</span> <span class="attr">role</span>=<span class="string">&quot;document&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;staticBackdropLabel&quot;</span>&gt;</span>更新代办事件<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Close&quot;</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--编辑框开始--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card card-primary&quot;</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;card-title&quot;</span>&gt;</span>更新代办事件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- /.card-header --&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- form start --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;updateForm&quot;</span> <span class="attr">name</span>=<span class="string">&quot;updateForm&quot;</span> <span class="attr">novalidate</span>=<span class="string">&quot;novalidate&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;detail_title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">a</span>&gt;</span>进展标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;detail_title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;detail_title&quot;</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;29&quot;</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">a</span>&gt;</span>事件状态<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control select2 select2-danger select2-hidden-accessible&quot;</span> <span class="attr">data-dropdown-css-class</span>=<span class="string">&quot;select2-danger&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;12&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;event_status&quot;</span> <span class="attr">name</span>=<span class="string">&quot;event_status&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;14&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span>未完成<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">option</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;35&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">option</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;36&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>终止<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;detail_content&quot;</span>&gt;</span>详细信息(选填)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;detail_content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;detail_content&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;50&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- /.card-body --&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--编辑框结束--&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-footer&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-secondary&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 更新进展Modal END Modal --&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">js内容</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">var</span> updateurl</span><br><span class="line">  $(<span class="string">&#x27;#updatemodal&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;show.bs.modal&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> button = $(event.<span class="property">relatedTarget</span>) <span class="comment">// Button that triggered the modal</span></span><br><span class="line">    <span class="comment">//注意这里的whatever对应前面html代码中button标签下data-whatever属性的后半段</span></span><br><span class="line">    updateurl = button.<span class="title function_">data</span>(<span class="string">&#x27;url&#x27;</span>) <span class="comment">// Extract info from data-* attributes</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// var user = button.data(&#x27;user&#x27;)</span></span><br><span class="line">    <span class="comment">// If necessary, you could initiate an AJAX request here (and then do the updating in a callback).</span></span><br><span class="line">    <span class="comment">// Update the modal&#x27;s content. We&#x27;ll use jQuery here, but you could use a data binding library or other methods instead.</span></span><br><span class="line">    <span class="keyword">var</span> modal = $(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="comment">//此处即为修改modal的标题</span></span><br><span class="line">    <span class="comment">// modal.find(&#x27;.modal-title&#x27;).text(&#x27;New message to &#x27; + recipient)</span></span><br><span class="line">    <span class="comment">// modal.find(&#x27;.modal-body input&#x27;).val(recipient)</span></span><br><span class="line">    <span class="comment">//modal.find(&#x27;.card-primary form&#x27;).attr(&quot;action&quot;,url)</span></span><br><span class="line">  &#125;)</span><br><span class="line">  $(<span class="string">&quot;.modal-footer button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止表单的默认提交行为</span></span><br><span class="line">    <span class="keyword">if</span> (!$(<span class="string">&quot;#updateForm&quot;</span>).<span class="title function_">valid</span>()) &#123;</span><br><span class="line">        <span class="comment">// 如果验证失败，返回false，不提交数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> formData = $(<span class="string">&quot;#updateForm&quot;</span>).<span class="title function_">serialize</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;updateurl&#x27;</span>+updateurl)</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: updateurl, <span class="comment">// 你的请求地址</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">// 请求类型，必须是POST</span></span><br><span class="line">        <span class="attr">data</span>: formData, <span class="comment">// 你的表单数据</span></span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>, <span class="comment">// 返回的数据类型，必须是json</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 请求成功，显示消息</span></span><br><span class="line">                $(<span class="string">&quot;#updatemodal&quot;</span>).<span class="title function_">modal</span>(<span class="string">&#x27;hide&#x27;</span>)</span><br><span class="line">                toastr.<span class="title function_">success</span>(<span class="string">&#x27;成功：&#x27;</span>+data.<span class="property">message</span>)</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    $(<span class="string">&#x27;#eventtable&#x27;</span>).<span class="title class_">DataTable</span>().<span class="property">ajax</span>.<span class="title function_">reload</span>();</span><br><span class="line"></span><br><span class="line">                &#125;, <span class="number">1000</span>)</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                toastr.<span class="title function_">error</span>(<span class="string">&#x27;失败：&#x27;</span>+data.<span class="property">message</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">// 请求失败的回调函数</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#updateForm&#x27;</span>).<span class="title function_">validate</span>(&#123;</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attr">detail_title</span>: &#123;</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">minlength</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">messages</span>: &#123;</span><br><span class="line">    <span class="attr">detail_title</span>: &#123;</span><br><span class="line">        <span class="attr">required</span>: <span class="string">&quot;请输入更新标题&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">errorElement</span>: <span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">    <span class="attr">errorPlacement</span>: <span class="keyword">function</span> (<span class="params">error, element</span>) &#123;</span><br><span class="line">    error.<span class="title function_">addClass</span>(<span class="string">&#x27;invalid-feedback&#x27;</span>);</span><br><span class="line">    element.<span class="title function_">closest</span>(<span class="string">&#x27;.form-group&#x27;</span>).<span class="title function_">append</span>(error);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">element, errorClass, validClass</span>) &#123;</span><br><span class="line">    $(element).<span class="title function_">addClass</span>(<span class="string">&#x27;is-invalid&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">unhighlight</span>: <span class="keyword">function</span> (<span class="params">element, errorClass, validClass</span>) &#123;</span><br><span class="line">    $(element).<span class="title function_">removeClass</span>(<span class="string">&#x27;is-invalid&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>django内容</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;a <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary btn-sm &#123;disabled&#125;&quot;</span> data-url=<span class="string">&quot;&#123;reverse(&#x27;event:eventupdate&#x27;,kwargs=&#123;&#x27;id&#x27;:Event.id&#125;)&#125;&quot;</span> data-toggle=<span class="string">&quot;modal&quot;</span> data-target=<span class="string">&quot;#updatemodal&quot;</span>&gt;</span><br><span class="line">    &lt;i <span class="keyword">class</span>=<span class="string">&quot;fas fa-history&quot;</span>&gt;&lt;/i&gt;</span><br><span class="line">    &lt;/i&gt;</span><br><span class="line">    更新进展</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>adminlte中使用时间插件</title>
      <link href="/posts/6646bac8/"/>
      <url>/posts/6646bac8/</url>
      
        <content type="html"><![CDATA[<h1>daterangepicker</h1><ul class="lvl-0"><li class="lvl-2">引入文件，语言是由moment控制的</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/daterangepicker/daterangepicker.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/moment/moment.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/moment/locale/zh-cn.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/daterangepicker/daterangepicker.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">a</span>&gt;</span>计划完成时间:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group date&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reservationdatetime&quot;</span> <span class="attr">data-target-input</span>=<span class="string">&quot;nearest&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control datetimepicker-input&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#reservationdatetime&quot;</span> <span class="attr">name</span>=<span class="string">&quot;event_deadline&quot;</span> <span class="attr">id</span>=<span class="string">&quot;event_deadline&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; event_deadline &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-append&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#reservationdatetime&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;datetimepicker&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-text&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-calendar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>验证，选择的时间不能大于当前时间</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比较时间</span></span><br><span class="line">     $.validator.<span class="title function_">addMethod</span>(<span class="string">&quot;compareDate&quot;</span>, <span class="keyword">function</span>(<span class="params">value, element</span>) &#123;  </span><br><span class="line">         <span class="keyword">var</span> event_deadline = $(<span class="string">&quot;#event_deadline&quot;</span>).<span class="title function_">val</span>();                        </span><br><span class="line">         <span class="keyword">var</span> date1 = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">parse</span>(event_deadline.<span class="title function_">replace</span>(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;/&quot;</span>))); </span><br><span class="line">         <span class="comment">// 和当前时间比较           </span></span><br><span class="line">         <span class="keyword">var</span> date2 = <span class="keyword">new</span> <span class="title class_">Date</span>();     </span><br><span class="line">         <span class="keyword">return</span> date1 &gt;= date2;        </span><br><span class="line">     &#125;,<span class="string">&quot;结束时间不能早于当前时间&quot;</span>);</span><br><span class="line">       <span class="comment">// 表单验证</span></span><br><span class="line">       $(<span class="string">&#x27;#editEventForm&#x27;</span>).<span class="title function_">validate</span>(&#123;</span><br><span class="line">         <span class="attr">rules</span>: &#123;</span><br><span class="line">           <span class="attr">event_deadline</span>: &#123;</span><br><span class="line">               <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">               <span class="attr">compareDate</span>: <span class="literal">true</span>,</span><br><span class="line">           &#125;,</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django在windows上开机自启动和打开网页</title>
      <link href="/posts/6646bac9/"/>
      <url>/posts/6646bac9/</url>
      
        <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>bat文件</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"># 使用虚拟环境，如果不用虚拟环境，这句去掉</span><br><span class="line">call D:\python\testing\.venv\Scripts\activate.bat</span><br><span class="line"># 执行</span><br><span class="line">python d:python\django-adminlte-template-master\django-adminlte-template-master\manage.py runserver 127.0.0.1:18888</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">进入下面这个目录，新建一个vbs文件</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>vbs文件内容，后面的路径是上面bat文件的路径，网址自定义</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run&quot;cmd /c D:\python\django-adminlte-template-master\startDjango.bat&quot;,0</span><br><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run&quot;http://127.0.0.1:18888&quot;, 3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django将查询结果转换为字典</title>
      <link href="/posts/4b442e59/"/>
      <url>/posts/4b442e59/</url>
      
        <content type="html"><![CDATA[<p>查询的结果默认是只读的，不能直接修改，如下面这样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event = event.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">event[<span class="string">&#x27;name&#x27;</span>] = <span class="number">123</span></span><br></pre></td></tr></table></figure><p>有时候可能需要把数据获取到，然后添加一个字段传给前端，这时候就可以用以下的办法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.forms.models <span class="keyword">import</span> model_to_dict</span><br><span class="line">event = model_to_dict(EventDB.objects.get(<span class="built_in">id</span>=event_id))</span><br><span class="line">event[<span class="string">&#x27;name&#x27;</span>] = <span class="number">123</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在adminlte中使用datatable</title>
      <link href="/posts/6646bac4/"/>
      <url>/posts/6646bac4/</url>
      
        <content type="html"><![CDATA[<h1>基本使用</h1><ul class="lvl-0"><li class="lvl-2">引入文件</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables/jquery.dataTables.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">基本js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#usertable&#x27;</span>).<span class="title class_">DataTable</span>(&#123;</span><br><span class="line">        <span class="string">&quot;ajax&quot;</span>: <span class="string">&quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;columns&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;username&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;create_time&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;superuser&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;passwd_expire_time&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;button&quot;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">language</span>: &#123;<span class="comment">//自定义语言提示</span></span><br><span class="line">            <span class="string">&quot;processing&quot;</span>: <span class="string">&quot;处理中...&quot;</span>,</span><br><span class="line">            <span class="string">&quot;lengthMenu&quot;</span>: <span class="string">&quot;显示 _MENU_ 条用户数据&quot;</span>,</span><br><span class="line">            <span class="string">&quot;zeroRecords&quot;</span>: <span class="string">&quot;没有找到相应的结果&quot;</span>,</span><br><span class="line">            <span class="string">&quot;info&quot;</span>: <span class="string">&quot;第 _START_ 至 _END_ 行，共 _TOTAL_ 行&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoEmpty&quot;</span>: <span class="string">&quot;第 0 至 0 项结果，共 0 项&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoFiltered&quot;</span>: <span class="string">&quot;(由 _MAX_ 项结果过滤)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoPostFix&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;thousands&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;emptyTable&quot;</span>: <span class="string">&quot;表中数据为空&quot;</span>,</span><br><span class="line">            <span class="string">&quot;loadingRecords&quot;</span>: <span class="string">&quot;载入中...&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoThousands&quot;</span>: <span class="string">&quot;,&quot;</span>,</span><br><span class="line">            <span class="string">&quot;paginate&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;first&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;previous&quot;</span>: <span class="string">&quot;上页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;next&quot;</span>: <span class="string">&quot;下页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;last&quot;</span>: <span class="string">&quot;末页&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// &quot;stateSave&quot;: true,</span></span><br><span class="line">        <span class="comment">// &quot;bAutoWidth&quot;: true,</span></span><br><span class="line">        <span class="comment">// &quot;scrollX&quot;: &quot;true&quot;,</span></span><br><span class="line">        <span class="comment">// &quot;scrollY&quot;: &quot;600px&quot;,</span></span><br><span class="line">        <span class="comment">// &quot;scrollCollapse&quot;: true,</span></span><br><span class="line">        <span class="string">&quot;sDom&quot;</span>: <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-6&#x27;&lt;&#x27;#toolbar&#x27;&gt;&gt;&lt;&#x27;col-md-6&#x27;f&gt;&gt;&quot;</span> +  <span class="comment">//设置表格最上面内容，可以在这里添加按钮等其他设置</span></span><br><span class="line"><span class="string">&quot;t&quot;</span> + <span class="comment">//设置tables</span></span><br><span class="line"><span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-5 sm-center&#x27;li&gt;&lt;&#x27;col-md-7 text-right sm-center&#x27;p&gt;&gt;&quot;</span>,<span class="comment">//设置表格最下面显示内容</span></span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#toolbar&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;a href=&quot;&#123;% url &quot;manager:usercreate&quot; %&#125;&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;&lt;i class=&quot;fa fa-plus-square&quot;&gt;&lt;/i&gt;&amp;nbsp&amp;nbsp新建用户&lt;/button&gt;&lt;/a&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;eventtable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;table table-bordered table-striped  display hover&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>完成时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>事件等级<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>工作量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>后端分页</h1><p>html不变</p><ul class="lvl-0"><li class="lvl-2">js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> table = $(<span class="string">&#x27;#eventtable&#x27;</span>).<span class="title class_">DataTable</span>(&#123;</span><br><span class="line">        <span class="string">&quot;processing&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;serverSide&quot;</span>:<span class="literal">true</span>,  <span class="comment">// 服务器分页</span></span><br><span class="line">        <span class="string">&quot;stateSave&quot;</span>: <span class="literal">true</span>, <span class="comment">//状态保持</span></span><br><span class="line">        <span class="string">&quot;ajax&quot;</span>: <span class="string">&quot;&#123;% url &#x27;event:eventlist&#x27; %&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;autoWidth&quot;</span>:<span class="literal">true</span>,<span class="comment">////不开启自动宽度，用bootstrap的自适应去调整</span></span><br><span class="line">        <span class="string">&quot;lengthMenu&quot;</span>: [<span class="number">10</span>,<span class="number">50</span>, <span class="number">100</span>],<span class="comment">//表格行数选择框内数目 显示2条,4条,20条,50条</span></span><br><span class="line">        <span class="string">&quot;displayLength&quot;</span>: <span class="number">10</span>,<span class="comment">//默认的显示行数 (也就是每页显示几条数据)</span></span><br><span class="line">        <span class="string">&quot;info&quot;</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;columns&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;class&quot;</span>:<span class="string">&#x27;details-control&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;orderable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;data&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;defaultContent&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            &#125;, </span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_title&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_deadline&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_level&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_workload&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_label&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;event_status&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;button&quot;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: [[<span class="number">2</span>, <span class="string">&#x27;asc&#x27;</span>]],</span><br><span class="line">        <span class="string">&quot;language&quot;</span>: &#123;<span class="comment">//自定义语言提示</span></span><br><span class="line">            <span class="string">&quot;processing&quot;</span>: <span class="string">&quot;处理中...&quot;</span>,</span><br><span class="line">            <span class="string">&quot;lengthMenu&quot;</span>: <span class="string">&quot;显示 _MENU_ 项结果&quot;</span>,</span><br><span class="line">            <span class="string">&quot;zeroRecords&quot;</span>: <span class="string">&quot;没有找到相应的结果&quot;</span>,</span><br><span class="line">            <span class="string">&quot;info&quot;</span>: <span class="string">&quot;第 _START_ 至 _END_ 行，共 _TOTAL_ 行&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoEmpty&quot;</span>: <span class="string">&quot;第 0 至 0 项结果，共 0 项&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoFiltered&quot;</span>: <span class="string">&quot;(由 _MAX_ 项结果过滤)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoPostFix&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;thousands&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;emptyTable&quot;</span>: <span class="string">&quot;表中数据为空&quot;</span>,</span><br><span class="line">            <span class="string">&quot;loadingRecords&quot;</span>: <span class="string">&quot;载入中...&quot;</span>,</span><br><span class="line">            <span class="string">&quot;infoThousands&quot;</span>: <span class="string">&quot;,&quot;</span>,</span><br><span class="line">            <span class="string">&quot;paginate&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;first&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;previous&quot;</span>: <span class="string">&quot;上页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;next&quot;</span>: <span class="string">&quot;下页&quot;</span>,</span><br><span class="line">                <span class="string">&quot;last&quot;</span>: <span class="string">&quot;末页&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;sDom&quot;</span>: <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-6&#x27;&lt;&#x27;#toolbar&#x27;&gt;&gt;&lt;&#x27;col-md-6&#x27;f&gt;&gt;&quot;</span> +  <span class="comment">//设置表格最上面内容，可以在这里添加按钮等其他设置</span></span><br><span class="line">        <span class="string">&quot;t&quot;</span> + <span class="comment">//设置tables</span></span><br><span class="line">        <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-5 sm-center&#x27;li&gt;&lt;&#x27;col-md-7 text-right sm-center&#x27;p&gt;&gt;&quot;</span></span><br><span class="line">    &#125; );</span><br><span class="line">    $(<span class="string">&quot;#toolbar&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;a href=&quot;&#123;% url &quot;event:eventedit&quot; %&#125;&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;&lt;i class=&quot;fa fa-plus-square&quot;&gt;&lt;/i&gt;&amp;nbsp&amp;nbsp新建代办&lt;/button&gt;&lt;/a&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>django</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_query_data = request.GET</span><br><span class="line"><span class="comment"># 获取开始值</span></span><br><span class="line">start_index = <span class="built_in">int</span>(_query_data.get(<span class="string">&quot;start&quot;</span>,<span class="number">0</span>))</span><br><span class="line"><span class="comment"># 获取列表长度</span></span><br><span class="line">search_length = <span class="built_in">int</span>(_query_data.get(<span class="string">&quot;length&quot;</span>,<span class="number">10</span>))</span><br><span class="line"><span class="comment"># 算出列表区间</span></span><br><span class="line">end_index = start_index + search_length</span><br><span class="line"><span class="comment"># 搜索，前端点搜索，search[value]有数据，根据这个数据去搜索</span></span><br><span class="line"><span class="keyword">if</span> _query_data.get(<span class="string">&#x27;search[value]&#x27;</span>):</span><br><span class="line">    search_str =  _query_data.get(<span class="string">&#x27;search[value]&#x27;</span>)</span><br><span class="line">    <span class="comment"># 搜索有意义的段</span></span><br><span class="line"></span><br><span class="line">    EventInfo = EventDB.objects.<span class="built_in">filter</span>(Q(event_title__icontains=search_str) | Q(event_level__icontains=search_str) | Q(event_detail__icontains=search_str) | Q(event_label__icontains=search_str))</span><br><span class="line"><span class="keyword">else</span>:    </span><br><span class="line">    <span class="comment"># 没搜索就查全部</span></span><br><span class="line">    EventInfo = EventDB.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="comment"># 获取排序的列，这里循环了10次，可以根据自己的列数进行调整</span></span><br><span class="line">order_args = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    order_column=<span class="string">&#x27;order[%d][column]&#x27;</span> % i</span><br><span class="line">    <span class="keyword">if</span> _query_data.get(order_column):   </span><br><span class="line">        order_col = _query_data.get(<span class="string">f&quot;columns[<span class="subst">&#123;_query_data.get(order_column)&#125;</span>][data]&quot;</span>)</span><br><span class="line">        order_args.append(order_col)</span><br><span class="line">    <span class="keyword">if</span> _query_data.get(<span class="string">&#x27;order[%d][dir]&#x27;</span> % i) == <span class="string">&quot;asc&quot;</span>:</span><br><span class="line">        order_col = <span class="string">&#x27;-&#x27;</span> + order_col</span><br><span class="line">        order_args.append(order_col)</span><br><span class="line"><span class="comment"># order_by可以传入多个值，在不确定要传入多少个值的情况下，可以把值先保存到列表，再通过*args把列表的多个值传入</span></span><br><span class="line">EventInfo = EventInfo.order_by(*order_args)[start_index:end_index]</span><br></pre></td></tr></table></figure><h1>datatable 定时刷新</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">refresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> table = $(<span class="string">&#x27;#eventtable&#x27;</span>).<span class="title class_">DataTable</span>();</span><br><span class="line">          table.<span class="property">ajax</span>.<span class="title function_">reload</span>(<span class="literal">null</span>, <span class="literal">false</span>); <span class="comment">// 刷新表格数据，分页信息不会重置</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// 每隔5秒刷新一次数据</span></span><br><span class="line">    <span class="built_in">setInterval</span>(refresh, <span class="number">5000</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在adminlte中使用select2</title>
      <link href="/posts/6646bac3/"/>
      <url>/posts/6646bac3/</url>
      
        <content type="html"><![CDATA[<p>引入<code>css</code>和<code>js</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/select2/css/select2.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/select2/js/select2.full.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>基本使用</h1><ul class="lvl-0"><li class="lvl-2"><p>html 复制的时候把<code>span</code>标签的内容去掉</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">a</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;select2-purple&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;select2bs4 select2-hidden-accessible&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;&quot;</span> <span class="attr">data-dropdown-css-class</span>=<span class="string">&quot;select2-purple&quot;</span> <span class="attr">data-placeholder</span>=<span class="string">&quot;Select a State&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span> <span class="attr">data-select2-id</span>=<span class="string">&quot;23&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;event_label&quot;</span> <span class="attr">id</span>=<span class="string">&quot;event_label&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">vlaue</span>=<span class="string">&quot;材料&quot;</span>&gt;</span>材料<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">vlaue</span>=<span class="string">&quot;学习&quot;</span>&gt;</span>学习<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">vlaue</span>=<span class="string">&quot;问题处理&quot;</span>&gt;</span>问题处理<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">vlaue</span>=<span class="string">&quot;会议&quot;</span>&gt;</span>会议<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">vlaue</span>=<span class="string">&quot;其它&quot;</span>&gt;</span>其它<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>js</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#event_label&quot;</span>).<span class="title function_">select2</span>()</span><br></pre></td></tr></table></figure><h1>默认值</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 默认单选</span><br><span class="line">$(<span class="string">&#x27;#event_label&#x27;</span>).<span class="title function_">val</span>(<span class="string">&quot;Low&quot;</span>)</span><br><span class="line"># jquery可以把字符串转换为数组</span><br><span class="line">arrValue = <span class="string">&quot;&#123;&#123; event_label &#125;&#125;&quot;</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"># 多选时，传入数组，可以默认选中多个</span><br><span class="line">$(<span class="string">&#x27;#event_label&#x27;</span>).<span class="title function_">val</span>(arrValue).<span class="title function_">trigger</span>(<span class="string">&#x27;change&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux创建证书</title>
      <link href="/posts/6646b637/"/>
      <url>/posts/6646b637/</url>
      
        <content type="html"><![CDATA[<p>创建证书请求文件CSR和私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -nodes -sha256 -newkey rsa:2048 -keyout [<span class="variable">$Key_File</span>] -out [<span class="variable">$OpenSSL_CSR</span>]</span><br><span class="line">说明</span><br><span class="line">new：指定生成一个新的 CSR 文件。</span><br><span class="line">nodes：指定密钥文件不被加密。</span><br><span class="line">sha256：指定摘要算法。</span><br><span class="line">newkey rsa:2048：指定密钥类型和长度。</span><br><span class="line">[<span class="variable">$Key_File</span>]：密钥文件名称。</span><br><span class="line">[<span class="variable">$OpenSSL_CSR</span>]：加密后文件的存放路径。new：指定生成一个新的 CSR 文件。</span><br><span class="line">4. 根据系统返回的提示，输入生成 CSR 文件所需的信息。以下是关于提示的说明：</span><br><span class="line">Organization Name：公司名称，可以是中文或英文。</span><br><span class="line">Organizational Unit Name：部门名称，可以是中文或英文。</span><br><span class="line">Country Code：申请单位所属国家，只能是两个字母的国家码。例如，中国填写为 CN。</span><br><span class="line">State or Province Name：州名或省份名称，可以是中文或英文。</span><br><span class="line">Locality Name：城市名称，可以是中文或英文。</span><br><span class="line">Common Name：申请 SSL 证书的具体网站域名。</span><br><span class="line">Email Address：可选择不输入。</span><br><span class="line">Challenge Password：可选择不输入。</span><br><span class="line">5. 按照命令提示输入相应内容后，即可在当前目录下获取密钥文件和 CSR 文件。</span><br></pre></td></tr></table></figure><p>创建证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -signkey xxx.key -<span class="keyword">in</span> xxx.csr -req -days 365 -out xxx.crt</span><br></pre></td></tr></table></figure><p>获取证书过期时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> &lt;cert&gt;.pem -noout -enddate</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django和adminlte笔记</title>
      <link href="/posts/6646bac2/"/>
      <url>/posts/6646bac2/</url>
      
        <content type="html"><![CDATA[<h1>django</h1><h2 id="新增环境">新增环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install python3-venv</span><br><span class="line">python3 -m venv django4</span><br><span class="line"><span class="built_in">source</span> django4/bin/active</span><br></pre></td></tr></table></figure><h2 id="安装Django">安装Django</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django  -i http://pypi.douban.com/simple/ --trusted-host=pypi.douban.com/simple </span><br></pre></td></tr></table></figure><h2 id="创建和初始化项目">创建和初始化项目</h2><p>创建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject mysite</span><br></pre></td></tr></table></figure><p>修改settings文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os <span class="comment"># 新增</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>] <span class="comment">#修改</span></span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR,<span class="string">&#x27;templates&#x27;</span>)], <span class="comment">#修改</span></span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 以下为修改</span></span><br><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 新增static</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;static&quot;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>新增文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> 项目目录/templates 项目目录/static</span><br></pre></td></tr></table></figure><h2 id="自定义用户模型">自定义用户模型</h2><p>新建一个app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp manager</span><br></pre></td></tr></table></figure><p>注册到settings.py中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;manager&#x27;</span>, <span class="comment">#新增</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>修改manager/models.py，根据自己的需要修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> BaseUserManager,AbstractUser</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="comment"># 自定义user，还需要在setting文件中配置AUTH_USER_MODELS</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDB</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class="line">    uid = models.UUIDField(primary_key=<span class="literal">True</span>,default=uuid.uuid4)</span><br><span class="line">    username = models.CharField(max_length=<span class="number">15</span>,verbose_name=<span class="string">&quot;用户名&quot;</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>,verbose_name=<span class="string">&quot;手机号码&quot;</span>, null=<span class="literal">True</span>,blank=<span class="literal">True</span>)</span><br><span class="line">    email = models.EmailField(verbose_name=<span class="string">&#x27;邮箱&#x27;</span>, null=<span class="literal">True</span>,blank=<span class="literal">True</span>)</span><br><span class="line">    create_time = models.DateTimeField(<span class="string">&#x27;创建时间&#x27;</span>,auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    update_time = models.DateTimeField(<span class="string">&#x27;更新时间&#x27;</span>,auto_now=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;用户信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.username</span><br></pre></td></tr></table></figure><p>编辑settings.py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增自定义用户模型</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;manager.UserDB&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="数据库迁移">数据库迁移</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成迁移文件</span></span><br><span class="line">python manage.py makemigrations</span><br><span class="line"><span class="comment">#应用迁移文件</span></span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><h2 id="创建用户">创建用户</h2><ul class="lvl-0"><li class="lvl-2"><p>管理员用户</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>普通用户进入项目shell</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py shell</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User(用户数据库，默认为User，如果自定义了这里需要修改)</span><br><span class="line">User.objects.create_user(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;email@example.com&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="站点验证和登录">站点验证和登录</h2><p>除了指定界面，用户访问其他界面时，如果没有登录就跳到登录界面，登录完成后跳转到需要访问的界面比如用户访问：<a href="https://51yunwei.top/system/">https://51yunwei.top/system/</a> ，会跳转为 <a href="https://51yunwei.top/login/?next=/system/%EF%BC%8C%E5%AE%8C%E6%88%90%E7%99%BB%E5%BD%95%E5%90%8E%EF%BC%8C%E8%B7%B3%E8%BD%AC%E5%9B%9Ehttps://51yunwei.top/system/">https://51yunwei.top/login/?next=/system/，完成登录后，跳转回https://51yunwei.top/system/</a><br>此处代码来自运维咖啡吧，通过中间件的方式进行处理</p><ul class="lvl-0"><li class="lvl-2"><p>新建一个目录</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> system/middleware -p</span><br><span class="line"><span class="built_in">cd</span> system/middleware</span><br><span class="line"><span class="built_in">touch</span> __init__.py</span><br><span class="line"><span class="built_in">touch</span> loginrequired.py</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>编辑loginrequired.py文件</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginRequiredMiddleware</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, get_response</span>): <span class="comment"># 启动django的时候会执行init，用get_resonpse来获取下一个中间件或视图函数的响应</span></span><br><span class="line">        self.get_response = get_response </span><br><span class="line">        self.login_url = settings.LOGIN_URL</span><br><span class="line">        self.open_urls = [self.login_url] + <span class="built_in">getattr</span>(settings, <span class="string">&#x27;OPEN_URLS&#x27;</span>, []) <span class="comment"># 登录界面和OPEN_URLS里面的路径都是开放的</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, request</span>): <span class="comment"># 每次有请求到达时，Django都会调用这个方法。</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.user.is_authenticated <span class="keyword">and</span> request.path_info <span class="keyword">not</span> <span class="keyword">in</span> self.open_urls:</span><br><span class="line">            <span class="keyword">return</span> redirect(self.login_url + <span class="string">&#x27;?next=&#x27;</span> + request.path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(request) <span class="comment"># 每个中间件都有一个get_response函数，这个函数会返回下一个中间件或视图函数的响应。</span></span><br></pre></td></tr></table></figure><p>OPEN_URLS：不需要验证就能访问到的界面<br>LOGIN_URL：需要验证才能访问到的界面通过在settings中配置变量实现</p><ul class="lvl-0"><li class="lvl-2"><p>编辑settings文件</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;system.middleware.loginrequired.LoginRequiredMiddleware&#x27;</span>, <span class="comment"># 新增，根据自己的路径进行修改</span></span><br><span class="line">]</span><br><span class="line">&gt; 注意：验证的中间件要放最后面，因为最后一个中间件是第一个执行的。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增全局登录地址</span></span><br><span class="line">LOGIN_URL=<span class="string">&#x27;/login/&#x27;</span></span><br><span class="line">OPEN_URLS=[]</span><br></pre></td></tr></table></figure><h2 id="在登录的函数中拿到next地址，并返回，如下">在登录的函数中拿到next地址，并返回，如下</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">&#x27;base.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="comment"># 判断用户登录</span></span><br><span class="line">        next_path = request.GET.get(<span class="string">&#x27;next&#x27;</span>,<span class="string">&#x27;/&#x27;</span>) <span class="comment"># 虽然是post方法，但还是可以用GET来获取路径的参数，即 ?key=value</span></span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(&#x27;post next====&#x27;,request.POST.get(&#x27;next&#x27;,&#x27;&#x27;),request.POST)</span></span><br><span class="line">        user = authenticate(username=username,password=password)</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            login(request,user)</span><br><span class="line">            request.session[<span class="string">&quot;username&quot;</span>] = username</span><br><span class="line">            request.session.set_expiry(<span class="number">0</span>)  <span class="comment"># 设置session过期时间为一周后</span></span><br><span class="line">            <span class="keyword">return</span> redirect(next_path)</span><br><span class="line">        login_error_message = <span class="string">&#x27;用户名或密码错误&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;登录失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,&#123;<span class="string">&#x27;login_error_message&#x27;</span>:login_error_message&#125;)</span><br></pre></td></tr></table></figure><h2 id="返回函数">返回函数</h2><p>一些常见的视图返回函数的导入方式：</p><ol><li class="lvl-3"><p><code>HttpResponse</code>：这是一个Django内置的HTTP响应类，可以直接从<code>django.http</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p><code>HttpResponseRedirect</code>：这也是一个Django内置的HTTP响应类，可以直接从<code>django.http</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p><code>render</code>：这是一个用于渲染模板并返回HTTP响应的函数，可以从<code>django.shortcuts</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p><code>redirect</code>：这是一个用于返回重定向视图的函数，也可以从<code>django.shortcuts</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p><code>JsonResponse</code>：这是一个用于返回JSON格式HTTP响应的函数，可以从<code>django.http</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p><code>Response</code>：这是Django REST Framework中的一个函数，用于返回HTTP响应，需要从<code>rest_framework.response</code>模块导入。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br></pre></td></tr></table></figure><ol start="7"><li class="lvl-3"><p><code>reverse</code></p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br></pre></td></tr></table></figure><h2 id="设置url">设置url</h2><p>在项目根urls.py中配置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include <span class="comment"># 新增include</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;manager.urls&#x27;</span>)), <span class="comment"># 新增，app名称.urls</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><a href="http://xn--appurls-qw3kg19de2rt2a417co16c.py">在app目录下新建urls.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.IndexView),</span><br><span class="line">    path(<span class="string">&#x27;user/&#x27;</span>,views.UserManager.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>,views.LoginView.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;user/&lt;uuid:uid&gt;/&#x27;</span>,views.UserDetail),</span><br><span class="line">    path(<span class="string">&#x27;logout/&#x27;</span>,views.LogOut),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="使用url模板标签生成路径">使用url模板标签生成路径</h2><ul class="lvl-0"><li class="lvl-2"><p>在url中配置name</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.IndexView),</span><br><span class="line">    path(<span class="string">&#x27;user/&#x27;</span>,views.UserManager.as_view(),name=<span class="string">&#x27;userlist&#x27;</span>), <span class="comment"># 配置name</span></span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>,views.LoginView.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;user/&lt;uuid:uid&gt;/&#x27;</span>,views.UserDetail),</span><br><span class="line">    path(<span class="string">&#x27;logout/&#x27;</span>,views.LogOut),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>在前端文件使用</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;userlist&#x27; %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果需要用到变量，year为变量 --&gt;</span></span><br><span class="line">&#123;% url &#x27;blog-list&#x27; year %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>如果有多个相同名称的name，可以在urls.py中设置一个app_name来区分</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># manager/urls.py</span></span><br><span class="line">app_name=<span class="string">&#x27;manager&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="获取post数据">获取post数据</h2><p>获取post数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username = request.POST.get(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>在post方法中也可以用GET</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="comment"># 判断用户登录</span></span><br><span class="line">        next_path = request.GET.get(<span class="string">&#x27;next&#x27;</span>,<span class="string">&#x27;/&#x27;</span>) <span class="comment"># 虽然是post方法，但还是可以用GET来获取路径的参数，即 ?key=value</span></span><br></pre></td></tr></table></figure><h2 id="登录和退出登录和session">登录和退出登录和session</h2><ul class="lvl-0"><li class="lvl-2"><p>登录和session</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate,login,logout</span><br><span class="line">username = request.POST.get(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">password = request.POST.get(<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># print(&#x27;post next====&#x27;,request.POST.get(&#x27;next&#x27;,&#x27;&#x27;),request.POST)</span></span><br><span class="line">user = authenticate(username=username,password=password)</span><br><span class="line"><span class="keyword">if</span> user:</span><br><span class="line">    login(request,user)</span><br><span class="line">    request.session[<span class="string">&quot;username&quot;</span>] = username <span class="comment"># 设置session</span></span><br><span class="line">    request.session.set_expiry(<span class="number">0</span>)  <span class="comment"># 关闭浏览器就过期</span></span><br><span class="line">    <span class="keyword">return</span> redirect(next_path)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>退出登录</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate,login,logout</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LogOut</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.user:</span><br><span class="line">        logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="设置密码和检查密码">设置密码和检查密码</h2><p>设置密码使用set_password</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.set_password(<span class="string">&#x27;xxxx&#x27;</span>)</span><br></pre></td></tr></table></figure><p>检查密码是否和输入的一致</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.hashers <span class="keyword">import</span> check_password</span><br><span class="line">check_password(request.POST.get(<span class="string">&#x27;currpassword&#x27;</span>),user.password)  <span class="comment"># 输入的密码，数据库中保存的密码</span></span><br></pre></td></tr></table></figure><h2 id="上传到github">上传到github</h2><p>1、生成requirements.txt文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; ./requirements.txt文件</span><br></pre></td></tr></table></figure><h2 id="设置全局可使用的变量">设置全局可使用的变量</h2><p>在template中，我们可以直接使用request变量，现在我们来设置一下可以直接使用的自定义变量<br>system/systeminfo.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> manager.models <span class="keyword">import</span> SystemInfoDB</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SystemInfo</span>(<span class="params">request</span>):</span><br><span class="line">    system_info = SystemInfoDB.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> system_info.count():</span><br><span class="line">        system_title = system_info.first().system_title <span class="keyword">if</span> system_info.first().system_title <span class="keyword">else</span> <span class="string">&#x27;未设置的title&#x27;</span></span><br><span class="line">        system_name = system_info.first().system_name <span class="keyword">if</span> system_info.first().system_name <span class="keyword">else</span> <span class="string">&#x27;未设置的系统名称&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        system_title = <span class="string">&#x27;未设置的title&#x27;</span></span><br><span class="line">        system_name = <span class="string">&#x27;未设置的系统名称&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;systeminfo&#x27;</span>:&#123;<span class="string">&#x27;system_title&#x27;</span>:system_title,<span class="string">&#x27;system_name&#x27;</span>:system_name&#125;&#125;</span><br></pre></td></tr></table></figure><p>manager/models.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SystemInfoDB</span>(models.Model):</span><br><span class="line">    system_title = models.CharField(max_length=<span class="number">128</span>,verbose_name=<span class="string">&quot;网页title&quot;</span>)</span><br><span class="line">    system_name = models.CharField(max_length=<span class="number">128</span>,verbose_name=<span class="string">&quot;站点名称&quot;</span>)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;系统信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.system_name</span><br></pre></td></tr></table></figure><p><a href="http://settings.py">settings.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR,<span class="string">&#x27;templates&#x27;</span>)],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;system.systeminfo.SystemInfo&#x27;</span>, <span class="comment"># 新增</span></span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>这样就可以直接在html中使用这个变量了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123; systeminfo.system_title &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>adminlte</h1><h2 id="点击菜单加载页面后，菜单没有高亮">点击菜单加载页面后，菜单没有高亮</h2><p>在base.html添加以下代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 选择所有class为&#x27;nav-sidebar&#x27;的ul元素下的li元素</span></span><br><span class="line">  $(<span class="string">&#x27;ul.nav-sidebar li&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i</span>)&#123;</span><br><span class="line">    <span class="comment">// 检查当前li元素的第一个子元素（即a标签）的href属性值是否为当前路径</span></span><br><span class="line">    <span class="keyword">if</span>($(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;a&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>)===<span class="string">&#x27;&#123;&#123; request.path &#125;&#125;&#x27;</span>)&#123;</span><br><span class="line">        <span class="comment">// 如果条件满足，则为当前li元素的第一个子元素（即a标签）添加&#x27;active&#x27;类</span></span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;a&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>优化版：比如用户管理一个菜单，里面有编辑用户、查看用户等，url为/user/xxxx/edit/、/user/xxx/detail/，这样的话上面的方法就不管用了，因为菜单是/user/，匹配不到/user/xxx/edit/，所以修改如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 选择所有class为&#x27;nav-sidebar&#x27;的ul元素下的li元素</span></span><br><span class="line">  $(<span class="string">&#x27;ul.nav-sidebar li&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i</span>)&#123;</span><br><span class="line">    <span class="comment">// 把patharr切割为列表，如[user,xxxx,eidt]</span></span><br><span class="line">    <span class="keyword">var</span> patharr = <span class="string">&#x27;&#123;&#123; request.path &#125;&#125;&#x27;</span>.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="comment">// 循环列表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = patharr.<span class="property">length</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="comment">// 获取列表的值，并转换为字符串</span></span><br><span class="line">      <span class="comment">// 比如一开始获取的值为 /user/xxx/edit/,如果没有匹配，下次循环为/user/xxx/，最后为/user/，只要有一个能匹配上，就把菜单高亮</span></span><br><span class="line">      <span class="keyword">var</span> newpatharr = patharr.<span class="title function_">slice</span>(<span class="number">0</span>, i);</span><br><span class="line">      <span class="keyword">var</span> path = newpatharr.<span class="title function_">join</span>(<span class="string">&quot;/&quot;</span>)+<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(path)</span><br><span class="line">       <span class="comment">// 检查当前li元素的第一个子元素（即a标签）的href属性值是否为当前路径</span></span><br><span class="line">      <span class="keyword">if</span>($(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;a&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>)===path)&#123;</span><br><span class="line">        <span class="comment">// 如果条件满足，则为当前li元素的第一个子元素（即a标签）添加&#x27;active&#x27;类</span></span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;a&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="data-widget属性">data-widget属性</h2><p>AdminLTE框架中就使用data-widget属性来激活一些插件，如iframe插件、todo list插件等。</p><p>以下是一个使用data-widget属性的例子：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span> <span class="attr">id</span>=<span class="string">&quot;calendar_widget&quot;</span> <span class="attr">data-widget</span>=<span class="string">&quot;chat-init&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这个例子中，data-widget=&quot;chat-init&quot;表示激活了一个名为&quot;chat-init&quot;的插件。</p><p>需要注意的是，data-widget属性并不是Bootstrap的标准属性，而是一些第三方框架（如AdminLTE）扩展出来的属性。因此，如果你在使用这些框架时遇到data-widget属性，可以参考相应的文档来了解其具体用法。</p><h2 id="ajax提交数据">ajax提交数据</h2><p>html代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;editUserForm&quot;</span> <span class="attr">novalidate</span>=<span class="string">&quot;novalidate&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; username &#125;&#125;&quot;</span> <span class="attr">readonly</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;Email&quot;</span>&gt;</span>邮箱地址<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; email &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>手机号码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; phone &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- /.card-body --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>修改&amp;保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success float-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 返回列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ajax代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#editUserForm button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止表单的默认提交行为</span></span><br><span class="line">    <span class="keyword">var</span> formData = $( <span class="string">&quot;#editUserForm&quot;</span> ).<span class="title function_">serialize</span>();</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;&#123;% url &#x27;manager:useredit&#x27; uid %&#125;&quot;</span>, <span class="comment">// 你的请求地址</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">// 请求类型，必须是POST</span></span><br><span class="line">        <span class="attr">data</span>: formData, <span class="comment">// 你的表单数据</span></span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>, <span class="comment">// 返回的数据类型，必须是json</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 请求成功，显示消息</span></span><br><span class="line">                toastr.<span class="title function_">success</span>(data.<span class="property">message</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                toastr.<span class="title function_">success</span>(data.<span class="property">message</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">// 请求失败的回调函数</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>python代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request,uid</span>):</span><br><span class="line">    op_user = request.user</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> op_user.is_superuser <span class="keyword">or</span> op_user.uid != uid: <span class="comment"># 如果不是管理员或者修改的不是自己的用户信息</span></span><br><span class="line">        resultdict = &#123;<span class="string">&#x27;result&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;message&#x27;</span>:<span class="string">&#x27;无权限修改其他用户的信息&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user = UserDB.objects.<span class="built_in">filter</span>(uid=uid).first()</span><br><span class="line">        user.email = request.POST.get(<span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        user.phone = request.POST.get(<span class="string">&#x27;phone&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        user.save()</span><br><span class="line">        resultdict = &#123;<span class="string">&#x27;result&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;message&#x27;</span>:<span class="string">&#x27;修改成功&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err :</span><br><span class="line">        resultdict = &#123;<span class="string">&#x27;result&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;message&#x27;</span>:<span class="string">&#x27;修改用户信息失败%s&#x27;</span> % err&#125;</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(resultdict)</span><br></pre></td></tr></table></figure><h2 id="吐司">吐司</h2><p>引入文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- toastr需要导入的css文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/toastr/toastr.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/sweetalert2/sweetalert2.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 吐司需要导入的js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/toastr/toastr.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/sweetalert2/sweetalert2.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>初始化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Toast</span> = <span class="title class_">Swal</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">            <span class="attr">toast</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">position</span>: <span class="string">&#x27;top-end&#x27;</span>,</span><br><span class="line">            <span class="attr">showConfirmButton</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">timer</span>: <span class="number">3000</span> # 多少秒后消失</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h2 id="返回上一个url">返回上一个url</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:history.go(-1);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="在datatable头添加一个按钮，和search平行">在datatable头添加一个按钮，和search平行</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;#usertable&quot;</span>).<span class="title class_">DataTable</span>(&#123;</span><br><span class="line">      <span class="string">&quot;responsive&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;lengthChange&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;autoWidth&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;buttons&quot;</span>: [<span class="string">&quot;copy&quot;</span>, <span class="string">&quot;csv&quot;</span>, <span class="string">&quot;excel&quot;</span>, <span class="string">&quot;pdf&quot;</span>, <span class="string">&quot;print&quot;</span>, <span class="string">&quot;colvis&quot;</span>],</span><br><span class="line">      <span class="string">&quot;sDom&quot;</span>: <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-6&#x27;&lt;&#x27;#toolbar&#x27;&gt;&gt;&lt;&#x27;col-md-6&#x27;f&gt;&gt;&quot;</span>,<span class="comment">//这里新增</span></span><br><span class="line">    &#125;).<span class="title function_">buttons</span>().<span class="title function_">container</span>().<span class="title function_">appendTo</span>(<span class="string">&#x27;#example1_wrapper .col-md-6:eq(0)&#x27;</span>);</span><br><span class="line">    $(<span class="string">&quot;#toolbar&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;a href=&quot;&#123;% url &quot;manager:usercreate&quot; %&#125;&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;&lt;i class=&quot;fa fa-plus-square&quot;&gt;&lt;/i&gt;&amp;nbsp&amp;nbsp新建主机&lt;/button&gt;&lt;/a&gt;&#x27;</span>) <span class="comment">//这里新增</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// document.querySelector(&#x27;div.toolbar&#x27;).innerHTML = &#x27;&lt;b&gt;Custom tool bar! Text/images etc.&lt;/b&gt;&#x27;;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="post后url显示参数，如何修改？">post后url显示参数，如何修改？</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在form标签增加以下字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return false&quot;</span> &gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="提交数据后，通过request-POST获取不到">提交数据后，通过request.POST获取不到</h2><p>前端post后，django是通过标签中的name='xxx’获取到数据的，比如<input name='username'>，后端通过reqeust.POST.get(‘username’)获取数据所以template一定要设置name属性</p><h2 id="自定义模态框的内容">自定义模态框的内容</h2><p>模态框html，id为mymodal</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 模态框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mymodal&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mymodaltitle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Close&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;mymodalcontent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-footer justify-content-between&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;mymodelhref&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: white;&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /.modal-content --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /.modal-dialog --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 模态框结束 --&gt;</span></span><br></pre></td></tr></table></figure><p>js代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里用的是模态框的id</span></span><br><span class="line">  $(<span class="string">&#x27;#mymodal&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;show.bs.modal&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> button = $(event.<span class="property">relatedTarget</span>) <span class="comment">// Button that triggered the modal</span></span><br><span class="line">    <span class="comment">//注意这里的whatever对应前面html代码中button标签下data-whatever属性的后半段，这里只要定义了data-xxx，就可以通过js获取</span></span><br><span class="line">    <span class="comment">// var recipient = button.data(&#x27;whatever&#x27;) // Extract info from data-* attributes</span></span><br><span class="line">    <span class="comment">// If necessary, you could initiate an AJAX request here (and then do the updating in a callback).</span></span><br><span class="line">    <span class="comment">// Update the modal&#x27;s content. We&#x27;ll use jQuery here, but you could use a data binding library or other methods instead.</span></span><br><span class="line">    <span class="keyword">var</span> modal = $(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="comment">//此处即为修改modal的标题，都是通过class获取</span></span><br><span class="line">    modal.<span class="title function_">find</span>(<span class="string">&#x27;.modal-title&#x27;</span>).<span class="title function_">text</span>(<span class="string">&#x27;退出登录&#x27;</span>)</span><br><span class="line">    modal.<span class="title function_">find</span>(<span class="string">&#x27;.modal-body p&#x27;</span>).<span class="title function_">text</span>(<span class="string">&quot;是否确认退出登录？&quot;</span>)</span><br><span class="line">    modal.<span class="title function_">find</span>(<span class="string">&#x27;.modal-footer a&#x27;</span>).<span class="title function_">text</span>(<span class="string">&quot;确认退出&quot;</span>)</span><br><span class="line">    modal.<span class="title function_">find</span>(<span class="string">&#x27;.modal-footer a&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&#123;% url &#x27;manager:logout&#x27; %&#125;&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>按钮的html只要设置了<code>data-toggle=&quot;modal&quot; data-target=&quot;#mymodal&quot;</code>就行，其中<code>data-target</code>是要弹出的模态框</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span>  <span class="attr">href</span>=<span class="string">&quot;/logout/&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;logoutbtn&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#mymodal&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="jQuery表单校验">jQuery表单校验</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/jquery-validation/jquery.validate.min.js&#x27; %&#125;&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/jquery-validation/additional-methods.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// ajax提交的时候要验证一下</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="string">&quot;#createUserForm button[type=&#x27;submit&#x27;]&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            e.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止表单的默认提交行为</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (!$(<span class="string">&quot;#createUserForm&quot;</span>).<span class="title function_">valid</span>()) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">// 如果验证失败，返回false，不提交数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> formData = $( <span class="string">&quot;#createUserForm&quot;</span> ).<span class="title function_">serialize</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">url</span>: <span class="string">&quot;&#123;% url &#x27;manager:usercreate&#x27; %&#125;&quot;</span>, <span class="comment">// 你的请求地址</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">// 请求类型，必须是POST</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">data</span>: formData, <span class="comment">// 你的表单数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>, <span class="comment">// 返回的数据类型，必须是json</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">0</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="comment">// 请求成功，显示消息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        toastr.<span class="title function_">success</span>(data.<span class="property">message</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="comment">// window.location.href = &quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        &#125;, <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">result</span> === <span class="number">1</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        toastr.<span class="title function_">error</span>(data.<span class="property">message</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="comment">// 请求失败的回调函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 验证规则</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$.validator.<span class="title function_">addMethod</span>(<span class="string">&quot;letterswithnumber&quot;</span>, <span class="keyword">function</span>(<span class="params">value,element</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">optional</span>(element) || <span class="regexp">/^(?=.*[a-z])(?=.*[0-9]).*$/i</span>.<span class="title function_">test</span>(value);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="string">&quot;密码中必须包含字母、数字和特殊字符&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $.validator.<span class="title function_">addMethod</span>(<span class="string">&quot;specialchar&quot;</span>, <span class="keyword">function</span>(<span class="params">value,element</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">optional</span>(element) || <span class="regexp">/^(?=.*[!@#\$%\^&amp;\*\(\)\-_=+&#123;&#125;:\,\&lt;\&gt;\?]).*$/i</span>.<span class="title function_">test</span>(value);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="string">&quot;密码中必须包含字母、数字和特殊字符&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="string">&#x27;#createUserForm&#x27;</span>).<span class="title function_">validate</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">rules</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">email</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">email</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">password</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">letterswithnumber</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">specialchar</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">minlength</span>: <span class="number">8</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">confirmpassword</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">equalTo</span>: <span class="string">&quot;#password&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">username</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">pattern</span>: <span class="regexp">/^[a-zA-Z0-9]+$/</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">minlength</span>: <span class="number">5</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">messages</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">email</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">email</span>: <span class="string">&quot;请输入正确的邮箱&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">password</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="string">&quot;请提供密码&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">etterswithnumber</span>: <span class="string">&quot;密码中必须包含字母和数字&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">specialchar</span>: <span class="string">&quot;密码中必须包含特殊字符&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">minlength</span>: <span class="string">&quot;密码至少 8 个字符，至少包含三种符号&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">username</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="string">&quot;请输入用户名&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">minlength</span>: <span class="string">&quot;用户名至少 5 个字符，仅允许字母和数字&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">confirmpassword</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">required</span>: <span class="string">&quot;请提供确认密码&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">equalTo</span>: <span class="string">&quot;确认密码与密码不一致&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">errorElement</span>: <span class="string">&#x27;span&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">errorPlacement</span>: <span class="keyword">function</span> (<span class="params">error, element</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            error.<span class="title function_">addClass</span>(<span class="string">&#x27;invalid-feedback&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            element.<span class="title function_">closest</span>(<span class="string">&#x27;.form-group&#x27;</span>).<span class="title function_">append</span>(error);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">element, errorClass, validClass</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $(element).<span class="title function_">addClass</span>(<span class="string">&#x27;is-invalid&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">unhighlight</span>: <span class="keyword">function</span> (<span class="params">element, errorClass, validClass</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $(element).<span class="title function_">removeClass</span>(<span class="string">&#x27;is-invalid&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="使用datatable">使用datatable</h2><p>html代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;usertable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;table table-bordered table-striped&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>创建时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>手机号码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>js代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#usertable&#x27;</span>).<span class="title class_">DataTable</span>(&#123;</span><br><span class="line">                <span class="string">&quot;ajax&quot;</span>: <span class="string">&quot;&#123;% url &#x27;manager:userlist&#x27; %&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;columns&quot;</span>: [</span><br><span class="line">                    &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;username&quot;</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;create_time&quot;</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;email&quot;</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;phone&quot;</span>&#125;,</span><br><span class="line">                    &#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;button&quot;</span>&#125;,</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">language</span>: &#123;<span class="comment">//自定义语言提示</span></span><br><span class="line">                    <span class="string">&quot;processing&quot;</span>: <span class="string">&quot;处理中...&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;lengthMenu&quot;</span>: <span class="string">&quot;显示 _MENU_ 条用户数据&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;zeroRecords&quot;</span>: <span class="string">&quot;没有找到相应的结果&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;info&quot;</span>: <span class="string">&quot;第 _START_ 至 _END_ 行，共 _TOTAL_ 行&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;infoEmpty&quot;</span>: <span class="string">&quot;第 0 至 0 项结果，共 0 项&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;infoFiltered&quot;</span>: <span class="string">&quot;(由 _MAX_ 项结果过滤)&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;infoPostFix&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;thousands&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;emptyTable&quot;</span>: <span class="string">&quot;表中数据为空&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;loadingRecords&quot;</span>: <span class="string">&quot;载入中...&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;infoThousands&quot;</span>: <span class="string">&quot;,&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;paginate&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;first&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;previous&quot;</span>: <span class="string">&quot;上页&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;next&quot;</span>: <span class="string">&quot;下页&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;last&quot;</span>: <span class="string">&quot;末页&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                </span><br><span class="line">                <span class="string">&quot;sDom&quot;</span>: <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-6&#x27;&lt;&#x27;#toolbar&#x27;&gt;&gt;&lt;&#x27;col-md-6&#x27;f&gt;&gt;&quot;</span> +  <span class="comment">//设置表格最上面内容，可以在这里添加按钮等其他设置</span></span><br><span class="line">        <span class="string">&quot;t&quot;</span> + <span class="comment">//设置tables</span></span><br><span class="line">        <span class="string">&quot;&lt;&#x27;row&#x27;&lt;&#x27;col-md-5 sm-center&#x27;li&gt;&lt;&#x27;col-md-7 text-right sm-center&#x27;p&gt;&gt;&quot;</span>,<span class="comment">//设置表格最下面显示内容</span></span><br><span class="line">                <span class="attr">buttons</span>: [&#123;</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;&lt;i class=&quot;fa fa-download&quot; title=&quot;导出execl&quot;&gt;&lt;/i&gt;&#x27;</span>,</span><br><span class="line">                    <span class="attr">extend</span>: <span class="string">&#x27;excel&#x27;</span>, <span class="comment">// 导出为execl</span></span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;用户列表&#x27;</span>+<span class="title class_">Date</span>.<span class="title function_">now</span>(), <span class="comment">// 导出文件的名字</span></span><br><span class="line">                    <span class="attr">className</span>: <span class="string">&#x27;btn btn-primary&#x27;</span>, <span class="comment">// 按钮样式</span></span><br><span class="line">                    <span class="attr">exportOptions</span>:&#123;</span><br><span class="line">                        <span class="attr">columns</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="comment">// 导出哪些列</span></span><br><span class="line">                        <span class="comment">// rows:[1,2,3,4] //导出哪些行</span></span><br><span class="line">                        <span class="attr">modifier</span>: &#123;</span><br><span class="line">                            <span class="attr">page</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// 导出哪些页的数据，all为所有，current为当前页</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="title class_">Headers</span>: <span class="literal">true</span>,<span class="comment">// 导出表格表头</span></span><br><span class="line">                        <span class="attr">footer</span>: <span class="literal">true</span>,<span class="comment">// 导出表格表尾</span></span><br><span class="line">                        <span class="attr">extension</span>: <span class="string">&quot;.xlsx&quot;</span>, <span class="comment">// 导出的文件后缀</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;]</span><br><span class="line">          &#125;);</span><br><span class="line">          $(<span class="string">&quot;#toolbar&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;a href=&quot;&#123;% url &quot;manager:usercreate&quot; %&#125;&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;&lt;i class=&quot;fa fa-plus-square&quot;&gt;&lt;/i&gt;&amp;nbsp&amp;nbsp新建用户&lt;/button&gt;&lt;/a&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>后端代码，返回的格式UserDict[“data”]，data要和js的columns data名称一致</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">UserIndex</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;user/index.html&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserManager</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="comment"># if not  request.META.get(&#x27;HTTP_X_REQUESTED_WITH&#x27;) == &#x27;XMLHttpRequest&#x27;:</span></span><br><span class="line">        <span class="comment">#     return render(request,&#x27;user/index.html&#x27;)</span></span><br><span class="line">        <span class="comment"># print(&#x27;not ajax request&#x27;)</span></span><br><span class="line">        UserInfo = UserDB.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># print(user)</span></span><br><span class="line">        UserList = []</span><br><span class="line">        <span class="keyword">for</span> User <span class="keyword">in</span> UserInfo:</span><br><span class="line">            username = User.username</span><br><span class="line">            create_time =User.create_time</span><br><span class="line">            email = User.email</span><br><span class="line">            phone = User.phone</span><br><span class="line">            button = <span class="string">&quot;&quot;&quot;&lt;div style=&quot;display: block;text-align: center;margin: auto;&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;btn btn-primary btn-sm&quot; href=&quot;&#123;0&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;i class=&quot;fas fa-folder&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;/i&gt;</span></span><br><span class="line"><span class="string">                                详情</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;a class=&quot;btn btn-info btn-sm&quot; href=&quot;&#123;1&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;i class=&quot;fas fa-pencil-alt&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;/i&gt;</span></span><br><span class="line"><span class="string">                                编辑</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;a class=&quot;btn btn-danger btn-sm&quot; data-url=&quot;&#123;2&#125;&quot; data-user=&#x27;&#123;3&#125;&#x27; data-toggle=&quot;modal&quot; data-target=&quot;#mymodal&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;i class=&quot;fas fa-trash&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;/i&gt;</span></span><br><span class="line"><span class="string">                                删除</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.<span class="built_in">format</span>(reverse(<span class="string">&#x27;manager:userdetail&#x27;</span>,kwargs=&#123;<span class="string">&#x27;uid&#x27;</span>:User.uid&#125;),reverse(<span class="string">&#x27;manager:useredit&#x27;</span>,kwargs=&#123;<span class="string">&#x27;uid&#x27;</span>:User.uid&#125;),reverse(<span class="string">&#x27;manager:userdel&#x27;</span>,kwargs=&#123;<span class="string">&#x27;uid&#x27;</span>:User.uid&#125;),User.username)</span><br><span class="line">            UserList.append(&#123;<span class="string">&#x27;username&#x27;</span>: User.username,<span class="string">&#x27;create_time&#x27;</span>:User.create_time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>),<span class="string">&#x27;email&#x27;</span>:User.email,<span class="string">&#x27;phone&#x27;</span>: User.phone,<span class="string">&#x27;uid&#x27;</span>:<span class="built_in">str</span>(User.uid),<span class="string">&#x27;button&#x27;</span>:button&#125;)</span><br><span class="line">            <span class="built_in">print</span>(username)</span><br><span class="line"></span><br><span class="line">        UserDict = &#123;&#125;</span><br><span class="line">        UserDict[<span class="string">&quot;data&quot;</span>] = UserList</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(UserDict))</span><br></pre></td></tr></table></figure><p><a href="http://urls.py">urls.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;user/&#x27;</span>,views.UserIndex,name=<span class="string">&#x27;userindex&#x27;</span>),</span><br><span class="line">path(<span class="string">&#x27;user/list/&#x27;</span>,views.UserManager.as_view(),name=<span class="string">&#x27;userlist&#x27;</span>),</span><br></pre></td></tr></table></figure><h2 id="刷新datatable的数据">刷新datatable的数据</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#usertable&#x27;</span>).<span class="title class_">DataTable</span>().<span class="property">ajax</span>.<span class="title function_">reload</span>();</span><br></pre></td></tr></table></figure><h2 id="截断datatable数据">截断datatable数据</h2><p>使用DataTables提供的ellipsis插件，它专门用于文本的截断显示。这个插件可以对过长的文本进行截断，并在结尾添加省略号。使用这个插件非常简单，首先需要在HTML中引入相应的JS文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.datatables.net/plug-ins/1.11.3/dataRender/ellipsis.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在DataTables的配置中使用render.ellipsis方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#example&#x27;</span>).<span class="title class_">DataTable</span>(&#123;</span><br><span class="line">  <span class="comment">// 其他配置</span></span><br><span class="line">  <span class="string">&quot;columnDefs&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;targets&quot;</span>: [ <span class="number">0</span> ],</span><br><span class="line">      <span class="string">&quot;render&quot;</span>: $.fn.<span class="property">dataTable</span>.<span class="property">render</span>.<span class="title function_">ellipsis</span>( <span class="number">40</span> ) <span class="comment">// 截断长度为40个字符</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## datatables默认排序</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="string">&quot;order&quot;</span>: [[ <span class="number">1</span>, <span class="string">&quot;desc&quot;</span> ]]</span><br></pre></td></tr></table></figure><h2 id="bootstrap-switch监听按钮变化事件">bootstrap-switch监听按钮变化事件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#userstat_value&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;switchChange.bootstrapSwitch&#x27;</span>, <span class="keyword">function</span> (<span class="params">event,state</span>) &#123; </span><br><span class="line">      <span class="keyword">var</span> status = <span class="variable language_">this</span>.<span class="property">checked</span> ? <span class="string">&#x27;True&#x27;</span> : <span class="string">&#x27;False&#x27;</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userstat&#x27;</span>+status)</span><br><span class="line">      $(<span class="string">&#x27;input[name=&quot;userstat&quot;]&#x27;</span>).<span class="title function_">val</span>(status);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="文件上传">文件上传</h2><p>html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 不在form表单中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;logoimg&quot;</span>&gt;</span>站点图标(33x33)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;file-loading&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;logoimg&quot;</span> <span class="attr">name</span>=<span class="string">&quot;logoimg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>js文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;&#123;% static &#x27;adminlte/plugins/bs-custom-file-input/bs-custom-file-input.js&#x27; %&#125;&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;!-- bootstrap <span class="number">5.</span>x or <span class="number">4.</span>x is supported. <span class="title class_">You</span> can also use the bootstrap css <span class="number">3.3</span>.<span class="property">x</span> versions --&gt;</span><br><span class="line">&lt;!-- &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot; crossorigin=&quot;anonymous&quot;&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- default icons used in the plugin are from Bootstrap 5.x icon library (which can be enabled by loading CSS below) --&gt;</span><br><span class="line">&lt;!-- &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css&quot; crossorigin=&quot;anonymous&quot;&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- alternatively you can use the font awesome icon library if using with `fas` theme (or Bootstrap 4.x) by uncommenting below. --&gt;</span><br><span class="line">&lt;!-- link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.15.4/css/all.css&quot; crossorigin=&quot;anonymous&quot; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- the fileinput plugin styling CSS file --&gt;</span><br><span class="line">&lt;link href=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/css/fileinput.min.css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- if using RTL (Right-To-Left) orientation, load the RTL CSS file after fileinput.css by uncommenting below --&gt;</span><br><span class="line">&lt;!-- link href=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/css/fileinput-rtl.min.css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- the jQuery Library --&gt;</span><br><span class="line">&lt;!-- &lt;script src=&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- buffer.min.js and filetype.min.js are necessary in the order listed for advanced mime type parsing and more correct</span><br><span class="line">     preview. This is a feature available since v5.5.0 and is needed if you want to ensure file mime type is parsed </span><br><span class="line">     correctly even if the local file&#x27;s extension is named incorrectly. This will ensure more correct preview of the</span><br><span class="line">     selected file (note: this will involve a small processing overhead in scanning of file contents locally). If you </span><br><span class="line">     do not load these scripts then the mime type parsing will largely be derived using the extension in the filename</span><br><span class="line">     and some basic file content parsing signatures. --&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/buffer.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/filetype.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you</span><br><span class="line">    wish to resize images before upload. This must be loaded before fileinput.min.js --&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/piexif.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview. </span><br><span class="line">    This must be loaded before fileinput.min.js --&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/plugins/sortable.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- bootstrap.bundle.min.js below is needed if you wish to zoom and preview file content in a detail modal</span><br><span class="line">    dialog. bootstrap 5.x or 4.x is supported. You can also use the bootstrap js 3.3.x versions. --&gt;</span><br><span class="line">&lt;!-- &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- the main fileinput plugin script JS file --&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/fileinput.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- following theme script is needed to use the Font Awesome 5.x theme (`fas`). Uncomment if needed. --&gt;</span><br><span class="line">&lt;!-- script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/themes/fas/theme.min.js&quot;&gt;&lt;/script --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- optionally if you need translation for your language then include the locale file as mentioned below (replace LANG.js with your language locale) --&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.2/js/locales/LANG.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  $(&quot;#logoimg&quot;).fileinput(&#123;</span><br><span class="line">        showUpload: true,  //显示上传按钮</span><br><span class="line">        dropZoneEnabled: false,</span><br><span class="line">        maxFileCount: 1, //最大选择的文件数</span><br><span class="line">        inputGroupClass: &quot;input-group-lg&quot;,</span><br><span class="line">        allowedFileExtensions: [&quot;png&quot;], // 允许的文件扩展名</span><br><span class="line">        language: &#x27;zh&#x27;,</span><br><span class="line">        uploadUrl: &quot;&#123;% url &#x27;manager:system&#x27; %&#125;&quot;, // 上传的URL</span><br><span class="line">        </span><br><span class="line">    &#125;).on(&quot;fileuploaded&quot;, function (e,data,previewId,index) &#123;</span><br><span class="line">                // 上传成功后触发的事件</span><br><span class="line">                toastr.success(&#x27;修改站点图标成功,当前界面可能有缓存,如未更新,请强制刷新一次&#x27;)</span><br><span class="line">                setTimeout(function() &#123;</span><br><span class="line">                    location.reload();</span><br><span class="line">                &#125;, 3000);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ace编辑器">ace编辑器</h3><p>引入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 地址 --&gt;</span></span><br><span class="line">https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.min.js</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>IP地址（选择黑/白名单时需配置，每行一个IP或网段，如1.1.1.1 或者 1.1.1.0/24）<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;form_content&quot;</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:415px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;ace/ace.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ACE配置</span></span><br><span class="line">     <span class="keyword">var</span> editor = ace.<span class="title function_">edit</span>(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">     <span class="keyword">var</span> textarea = $(<span class="string">&#x27;textarea[name=&quot;content&quot;]&#x27;</span>).<span class="title function_">hide</span>();</span><br><span class="line">     editor.<span class="title function_">getSession</span>().<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       textarea.<span class="title function_">val</span>(editor.<span class="title function_">getSession</span>().<span class="title function_">getValue</span>());</span><br><span class="line">     &#125;);</span><br><span class="line">     editor.<span class="title function_">setShowPrintMargin</span>(<span class="literal">false</span>);</span><br><span class="line">     <span class="comment">// 字体大小</span></span><br><span class="line">     editor.<span class="title function_">setFontSize</span>(<span class="number">18</span>);</span><br><span class="line">     editor.<span class="title function_">resize</span>()</span><br></pre></td></tr></table></figure><h2 id="js换行">js换行</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> multiLineString = <span class="string">`这是第一行</span></span><br><span class="line"><span class="string">这是第二行`</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> adminlte </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试图片</title>
      <link href="/posts/6646bad0/"/>
      <url>/posts/6646bad0/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 博客测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/undefined/"/>
      <url>/posts/undefined/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start">Quick Start</h2><h3 id="Create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 博客测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Github Page + Hexo 搭建个人博客问题小记</title>
      <link href="/posts/6646bac1/"/>
      <url>/posts/6646bac1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在使用Github Page + Hexo搭建个人博客的时候遇到了一些问题，现记录如下，主题使用的是cactus</p></blockquote><h1>问题1 hexo-deployer-git 提示输入用户名/密码</h1><p>在<code>deploy</code>中配置了<code>token</code>后，使用<code>hexo g -d</code>部署到<code>Github</code>，提示输入用户名密码，但是现在<code>Github</code>已经不支持命令行使用用户名密码登录了，所以需要改为<code>SSH</code>的方式，将<code>deploy</code>的<code>token</code>去掉，<code>repo</code>配置为<code>git@github.com/用户名/仓库名</code>在Github仓库下，选择<code>Settings &gt; Deploy keys &gt;添加一个Deploy key</code>，将系统的<code>~/.ssh/xxxx.pub</code>文件的内容布置上去，然后在GitHub界面勾选<code>Allow write access</code>即可。</p><h1>问题2 部署hexo后用自定义域名访问显示404，使用用户名.github.io访问正常</h1><p>方法1 这是因为部署hexo后，原来的CNAME文件被清除了，需要重新设置一下自定义域名。然后在hexo的<code>public</code>文件夹下，新建一个CNAME文件，内容为自定义的域名。如果不写这个文件的话，后面使用<code>hexo g -d</code>，有得重新设置一下自定义域名了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> public/CNAME</span><br><span class="line">www.51yunwei.top</span><br></pre></td></tr></table></figure><p>方法2 一劳永逸的方法，在_config.yml中设置url和插件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://www.51yunwei.top</span></span><br><span class="line"><span class="attr">Plugins:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo-generator-cname</span></span><br></pre></td></tr></table></figure><p>安装插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-cname</span><br></pre></td></tr></table></figure><h1>问题3 修改cactus主题样式不生效</h1><p>按照官方文档修改了<code>_config.yml</code>文件中的<code>colorscheme</code>参数不生效，需要重新执行以下命令，执行完之后自定义域名又不能访问了，按照问题1进行处理。</p><p>只要修改了配置文件，都要执行以下命令生成新的新的静态文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure><h1>问题4 如何为每篇文章添加文字/图片？</h1><p>可以在主题下的<code>layout/post.ejs</code>中添加，把需要添加的内容放在<code>&lt;%- page.content %&gt;</code>后面，如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- page.content %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span> 感谢浏览，如对您有帮助或需联系我，欢迎关注我的微信公众号~<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试文章</title>
      <link href="/posts/6646baca/"/>
      <url>/posts/6646baca/</url>
      
        <content type="html"><![CDATA[<p>Test PageFrom 2023<br>Test PageForm Gzhou</p><p>图片测试</p><p>Django学习<br><a href="https://zhuanlan.zhihu.com/p/113447102">https://zhuanlan.zhihu.com/p/113447102</a></p><p>simpleui官网<br><a href="https://newpanjing.github.io/simpleui_docs/">https://newpanjing.github.io/simpleui_docs/</a></p><p>Test 2024/11/13</p>]]></content>
      
      
      <categories>
          
          <category> 博客测试 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
